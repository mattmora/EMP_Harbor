import{S as Wt,i as Ht,s as Bt,k as U,l as Q,m as Z,h as z,n as E,b as dt,I as at,J as vt,B as wt,K as Nt,L as bt,o as Ot,a as ct,c as ht,G as J,q as Vt,r as Kt,u as Ft}from"../../chunks/index-e4a90c97.js";function Jt(t,n,a){var c=a||{},s=c.noTrailing,o=s===void 0?!1:s,r=c.noLeading,h=r===void 0?!1:r,u=c.debounceMode,g=u===void 0?void 0:u,v,f=!1,y=0;function D(){v&&clearTimeout(v)}function k(_){var W=_||{},b=W.upcomingOnly,I=b===void 0?!1:b;D(),f=!I}function M(){for(var _=arguments.length,W=new Array(_),b=0;b<_;b++)W[b]=arguments[b];var I=this,T=Date.now()-y;if(f)return;function L(){y=Date.now(),n.apply(I,W)}function A(){v=void 0}!h&&g&&!v&&L(),D(),g===void 0&&T>t?h?(y=Date.now(),o||(v=setTimeout(g?A:L,t))):L():o!==!0&&(v=setTimeout(g?A:L,g===void 0?t-T:t))}return M.cancel=k,M}function Xt(t,n){return Math.sqrt(ot(t,n))}function ot(t,n){return Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)}function Yt(t,n,a){const c=ot(n,a);if(c===0)return ot(t,n);let s=((t[0]-n[0])*(a[0]-n[0])+(t[1]-n[1])*(a[1]-n[1]))/c;return s=Math.max(0,Math.min(1,s)),ot(t,O(n,a,s))}function O(t,n,a){return[t[0]+(n[0]-t[0])*a,t[1]+(n[1]-t[1])*a]}function jt(t,n){const a=t[n+0],c=t[n+1],s=t[n+2],o=t[n+3];let r=3*c[0]-2*a[0]-o[0];r*=r;let h=3*c[1]-2*a[1]-o[1];h*=h;let u=3*s[0]-2*o[0]-a[0];u*=u;let g=3*s[1]-2*o[1]-a[1];return g*=g,r<u&&(r=u),h<g&&(h=g),r+h}function ut(t,n,a,c){const s=c||[];if(jt(t,n)<a){const o=t[n+0];s.length?Xt(s[s.length-1],o)>1&&s.push(o):s.push(o),s.push(t[n+3])}else{const r=t[n+0],h=t[n+1],u=t[n+2],g=t[n+3],v=O(r,h,.5),f=O(h,u,.5),y=O(u,g,.5),D=O(v,f,.5),k=O(f,y,.5),M=O(D,k,.5);ut([r,v,D,M],0,a,s),ut([M,k,y,g],0,a,s)}return s}function ft(t,n,a,c,s){const o=s||[],r=t[n],h=t[a-1];let u=0,g=1;for(let v=n+1;v<a-1;++v){const f=Yt(t[v],r,h);f>u&&(u=f,g=v)}return Math.sqrt(u)>c?(ft(t,n,g+1,c,o),ft(t,g,a,c,o)):(o.length||o.push(r),o.push(h)),o}function Gt(t,n=.15,a){const c=[],s=(t.length-1)/3;for(let o=0;o<s;o++){const r=o*3;ut(t,r,n,c)}return a&&a>0?ft(c,0,c.length,a):c}function G(t){return[...t]}function Ut(t,n=0){const a=t.length;if(a<3)throw new Error("A curve must have at least three points.");const c=[];if(a===3)c.push(G(t[0]),G(t[1]),G(t[2]),G(t[2]));else{const s=[];s.push(t[0],t[0]);for(let h=1;h<t.length;h++)s.push(t[h]),h===t.length-1&&s.push(t[h]);const o=[],r=1-n;c.push(G(s[0]));for(let h=1;h+2<s.length;h++){const u=s[h];o[0]=[u[0],u[1]],o[1]=[u[0]+(r*s[h+1][0]-r*s[h-1][0])/6,u[1]+(r*s[h+1][1]-r*s[h-1][1])/6],o[2]=[s[h+1][0]+(r*s[h][0]-r*s[h+2][0])/6,s[h+1][1]+(r*s[h][1]-r*s[h+2][1])/6],o[3]=[s[h+1][0],s[h+1][1]],c.push(o[1],o[2],o[3])}}return c}const Qt=[[[3152.059889126087,1582.2779244897192],[2958.577498253122,2456.481932374286],[3123.205653211,3306.4157758369984],[4135.970029298883,3554.4187314194864],[2373.7907435462075,4016.999941682505]],[[0,0]],[[0,0]],[[0,0]]],st=(t,n,a,c)=>{var s=n-t,o=c-a;return Math.sqrt(s*s+o*o)};function _t(t,n,a){const c=t.slice();return c[35]=n[a],c[37]=a,c}function xt(t){let n,a=t[1][t[37]].pathString+"",c;return{c(){n=U("pre"),c=Vt(a),this.h()},l(s){n=Q(s,"PRE",{class:!0});var o=Z(n);c=Kt(o,a),o.forEach(z),this.h()},h(){E(n,"class","svelte-16xin6")},m(s,o){dt(s,n,o),J(n,c)},p(s,o){o[0]&2&&a!==(a=s[1][s[37]].pathString+"")&&Ft(c,a)},d(s){s&&z(n)}}}function Mt(t){let n,a,c,s,o,r,h,u,g,v,f,y=t[3]&&xt(t);function D(...M){return t[13](t[37],...M)}function k(...M){return t[14](t[37],...M)}return{c(){n=U("div"),y&&y.c(),a=ct(),c=U("canvas"),o=ct(),r=U("canvas"),u=ct(),this.h()},l(M){n=Q(M,"DIV",{id:!0,class:!0,style:!0});var _=Z(n);y&&y.l(_),a=ht(_),c=Q(_,"CANVAS",{id:!0,class:!0,style:!0}),Z(c).forEach(z),o=ht(_),r=Q(_,"CANVAS",{id:!0,class:!0,style:!0}),Z(r).forEach(z),u=ht(_),_.forEach(z),this.h()},h(){E(c,"id","map"+t[37]),E(c,"class","map svelte-16xin6"),E(c,"style",s=t[2][t[37]]+(t[3]?"height: 95%;":"")),E(r,"id","view"+t[37]),E(r,"class","view svelte-16xin6"),E(r,"style",h=t[3]?"height: 95%;":""),E(n,"id","viewport"+t[37]),E(n,"class","viewport svelte-16xin6"),E(n,"style",g=t[0]<0||t[0]==t[37]?"":"display: none")},m(M,_){dt(M,n,_),y&&y.m(n,null),J(n,a),J(n,c),J(n,o),J(n,r),J(n,u),v||(f=[at(r,"mousedown",D),at(r,"mousemove",Jt(40,k))],v=!0)},p(M,_){t=M,t[3]?y?y.p(t,_):(y=xt(t),y.c(),y.m(n,a)):y&&(y.d(1),y=null),_[0]&12&&s!==(s=t[2][t[37]]+(t[3]?"height: 95%;":""))&&E(c,"style",s),_[0]&8&&h!==(h=t[3]?"height: 95%;":"")&&E(r,"style",h),_[0]&1&&g!==(g=t[0]<0||t[0]==t[37]?"":"display: none")&&E(n,"style",g)},d(M){M&&z(n),y&&y.d(),v=!1,bt(f)}}}function Zt(t){let n,a,c,s=[...Array(R).keys()],o=[];for(let r=0;r<s.length;r+=1)o[r]=Mt(_t(t,s,r));return{c(){n=U("div");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){n=Q(r,"DIV",{class:!0,style:!0});var h=Z(n);for(let u=0;u<o.length;u+=1)o[u].l(h);h.forEach(z),this.h()},h(){E(n,"class","views svelte-16xin6"),E(n,"style",t[4])},m(r,h){dt(r,n,h);for(let u=0;u<o.length;u+=1)o[u].m(n,null);a||(c=[at(window,"keydown",vt(t[5])),at(window,"keyup",vt(t[6]))],a=!0)},p(r,h){if(h[0]&399){s=[...Array(R).keys()];let u;for(u=0;u<s.length;u+=1){const g=_t(r,s,u);o[u]?o[u].p(g,h):(o[u]=Mt(g),o[u].c(),o[u].m(n,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}h[0]&16&&E(n,"style",r[4])},i:wt,o:wt,d(r){r&&z(n),Nt(o,r),a=!1,bt(c)}}}const $t=.2,Ct=400,te=10,ee=.7,R=4;let St=180,Pt=100,Et=1;const lt=20;function ne(t,n,a){let c,s,o,r,h,u;const g=[],v=[],f=[];let y,D,k,M,_,W,b,I;const T={},L={};let A=-1;const qt=l=>{var i,e,d,C,x,w;for(let p=0;p<v.length;p++){if(A>=0&&p!=A)continue;const S=v[p],m=f[p];let{x:q,y:P,zoom:H}=S;const V=(i=T.e)!=null?i:0,X=(e=T.q)!=null?e:0,Y=V-X,Rt=Math.pow(1+Y*$t,l);if(H*=Rt,T.r&&(m.pathIndex=0,m.x=m.path[0][0],m.y=m.path[0][1]),L.v&&m.pathIndex<m.path.length-1){let j=m.pathLength/te*l;for(;j>0&&m.pathIndex<m.path.length-1;){let tt=m.pathIndex,et=m.path[tt+1][0],K=m.path[tt+1][1];const N=st(m.x,et,m.y,K);if(N>0&&(m.course=Math.atan2(K-m.y,et-m.x)),N==0){m.pathIndex++;continue}const F=Math.min(j,N),nt=Math.cos(m.course),zt=Math.sin(m.course);m.x+=nt*F,m.y+=zt*F,j-=F}}if(L.f){const B=ee*l;q=m.x*B+q*(1-B),P=m.y*B+P*(1-B)}else{const B=(d=T.a)!=null?d:0,j=(C=T.d)!=null?C:0,tt=(x=T.s)!=null?x:0,et=(w=T.w)!=null?w:0,K=j-B,N=et-tt,F=Math.sqrt(K*K+N*N),nt=F>0?1/F:0;q+=nt*K*Ct*l,P-=nt*N*Ct*l}S.x=q,S.y=P,S.zoom=H}T.r=!1},kt=()=>{const l=y.width/k.width;I.clearRect(0,0,b.width,b.height),f.forEach(i=>{I.beginPath(),I.fillStyle=i.color;const e=i.x+Math.cos(i.course)*20,d=i.y+Math.sin(i.course)*20,C=i.x+Math.cos(i.course+Math.PI/1.5)*20,x=i.y+Math.sin(i.course+Math.PI/1.5)*20,w=i.x+Math.cos(i.course-Math.PI/1.5)*20,p=i.y+Math.sin(i.course-Math.PI/1.5)*20;I.moveTo(e,d),I.lineTo(C,x),I.lineTo(i.x,i.y),I.lineTo(w,p),I.fill()}),v.forEach(({x:i,y:e,zoom:d,canvas:C,context:x,map:w})=>{const p=w.canvas.width=C.width=C.offsetWidth,S=w.canvas.height=C.height=C.offsetHeight;d*=A>=0?Math.ceil(Math.sqrt(R)):1;const m=d>.8,q=m?y:k,P=m?l:1,H=p/d,V=S/d,X=i-H*.5,Y=e-V*.5;u&&x.drawImage(_,X,Y,H,V,0,0,p,S),x.drawImage(b,X,Y,H,V,0,0,p,S),w.context.drawImage(q,X*P,Y*P,H*P,V*P,0,0,p,S)})};let gt;const pt=l=>{const i=l-gt;i>0&&(qt(i/1e3),kt()),gt=l,requestAnimationFrame(pt)},It=l=>{T[l.key.toLowerCase()]=1,a(9,L[l.key.toLowerCase()]=!L[l.key.toLowerCase()],L);let i=parseInt(l.key)-1;i==A||i>=R?a(0,A=-1):a(0,A=isNaN(i)?A:i)},Tt=l=>{T[l.key.toLowerCase()]=0},$=[];for(let l=0;l<R;l++)$.push(`filter: hue-rotate(${St+l*(360/R)}deg) invert(${Pt}%) saturate(${Et});`);Ot(()=>{y=document.createElement("canvas"),D=y.getContext("2d"),k=document.createElement("canvas"),M=k.getContext("2d"),_=document.createElement("canvas"),W=_.getContext("2d"),b=document.createElement("canvas"),I=b.getContext("2d");for(let e=0;e<R;e++){g.push({}),g[e].canvas=document.getElementById(`map${e}`),g[e].context=g[e].canvas.getContext("2d"),f.push({points:Qt[e],path:[],pathIndex:0,pathLength:0,pathString:"",editing:-1,color:Lt[e]}),rt(e,!0),a(1,f[e].x=f[e].path[0]?f[e].path[0][0]:0,f),a(1,f[e].y=f[e].path[0]?f[e].path[0][1]:0,f);const d=f[e].path[1]?f[e].path[1][0]:f[e].x,C=f[e].path[1]?f[e].path[1][1]:f[e].y;a(1,f[e].course=Math.atan2(C-f[e].y,d-f[e].x),f),v.push({x:f[e].x,y:f[e].y,zoom:1,map:g[e],ship:f[e]}),v[e].canvas=document.getElementById(`view${e}`),v[e].context=v[e].canvas.getContext("2d"),v.forEach(x=>{const{canvas:w,map:p}=x;p.canvas.width=w.width=w.offsetWidth,p.canvas.height=w.height=w.offsetHeight,x.x=w.width*.5,x.y=w.height*.5})}const l=new Image;l.src="/harbor/chart-5000.png",l.onload=()=>{k.width=l.naturalWidth,k.height=l.naturalHeight,_.width=l.naturalWidth,_.height=l.naturalHeight,b.width=l.naturalWidth,b.height=l.naturalHeight,M.drawImage(l,0,0),g.forEach(({canvas:e,context:d})=>{const C=e.width,x=e.height;d.drawImage(k,0,0,C,x,0,0,C,x)}),it()};const i=new Image;i.src="/harbor/chart-10000.png",i.onload=()=>{y.width=i.naturalWidth,y.height=i.naturalHeight,D.drawImage(i,0,0)},requestAnimationFrame(pt)});const Lt=["#ff00d7","#ff9900","#c9ff00","#0982ff"],it=()=>{const l=_,i=W;i.clearRect(0,0,l.width,l.height),f.forEach(({points:e,path:d,color:C})=>{if(d.length>0){i.beginPath(),i.lineWidth=3,i.strokeStyle=C,i.setLineDash([12,3]);let x=d[0][0],w=d[0][1];i.moveTo(x,w);for(let p=1;p<d.length;p++)x=d[p][0],w=d[p][1],i.lineTo(x,w);i.stroke();for(let p=0;p<e.length;p++)x=e[p][0],w=e[p][1],i.beginPath(),i.arc(x,w,lt,0,2*Math.PI),i.stroke()}})},rt=(l,i)=>{const e=f[l];if(e.points.length>3){const d=Ut(e.points);e.path=Gt(d,.8,1)}else e.path=e.points;e.pathLength=0;for(let d=1;d<e.path.length;d++)e.pathLength+=st(e.path[d-1][0],e.path[d][0],e.path[d-1][1],e.path[d][1]);i&&(e.pathString=JSON.stringify(e.points))},mt=(l,i)=>{if(!u)return;const e=f[i],{x:d,y:C,zoom:x,canvas:w}=v[i],p=d+(l.offsetX-w.width*.5)/x,S=C+(l.offsetY-w.height*.5)/x;if(l.button==0){if(e.editing>=0){let q=-1;for(let P=0;P<e.points.length;P++)if(Math.abs(P-e.editing)==1){var m=st(e.points[P][0],p,e.points[P][1],S);m<lt&&(q=P)}q<0?e.points[e.editing]=[p,S]:e.points.splice(e.editing,1),e.editing=-1}else{for(let q=0;q<e.points.length;q++){var m=st(e.points[q][0],p,e.points[q][1],S);m<lt&&(e.editing=q)}e.editing<0&&e.points.push([p,S])}rt(i,!0),it()}},yt=(l,i)=>{if(!u)return;const e=f[i],{x:d,y:C,zoom:x,canvas:w}=v[i],p=d+(l.offsetX-w.width*.5)/x,S=C+(l.offsetY-w.height*.5)/x;e.editing>=0&&(e.points[e.editing]=[p,S],rt(i),it())},At=(l,i)=>mt(i,l),Dt=(l,i)=>yt(i,l);t.$$.update=()=>{t.$$.dirty[0]&1&&a(10,c=A>=0?1:Math.ceil(Math.sqrt(R))),t.$$.dirty[0]&1024&&a(12,s=100/c),t.$$.dirty[0]&4096&&a(11,o=`${s}% `),t.$$.dirty[0]&3072&&a(4,r=`
	grid-template-columns: ${o.repeat(c)};
	grid-template-rows: ${o.repeat(c)};`),t.$$.dirty[0]&512&&a(3,h=L.c),t.$$.dirty[0]&512&&(u=!L.p)};for(let l=0;l<R;l++)a(2,$[l]=`filter: hue-rotate(${St+l*(360/R)}deg) invert(${Pt}%) saturate(${Et});`,$);return[A,f,$,h,r,It,Tt,mt,yt,L,c,o,s,At,Dt]}class oe extends Wt{constructor(n){super(),Ht(this,n,ne,Zt,Bt,{},null,[-1,-1])}}export{oe as default};
