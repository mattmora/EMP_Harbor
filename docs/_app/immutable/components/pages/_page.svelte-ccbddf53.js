import{S as Wt,i as Ht,s as Bt,k as U,l as Q,m as Z,h as z,n as E,b as dt,I as at,J as vt,B as wt,K as Nt,L as bt,o as Ot,a as lt,c as ct,G as J,q as Vt,r as Kt,u as Ft}from"../../chunks/index-e4a90c97.js";function Jt(t,n,a){var l=a||{},s=l.noTrailing,o=s===void 0?!1:s,r=l.noLeading,c=r===void 0?!1:r,u=l.debounceMode,g=u===void 0?void 0:u,y,f=!1,m=0;function D(){y&&clearTimeout(y)}function k(_){var W=_||{},b=W.upcomingOnly,I=b===void 0?!1:b;D(),f=!I}function M(){for(var _=arguments.length,W=new Array(_),b=0;b<_;b++)W[b]=arguments[b];var I=this,T=Date.now()-m;if(f)return;function L(){m=Date.now(),n.apply(I,W)}function A(){y=void 0}!c&&g&&!y&&L(),D(),g===void 0&&T>t?c?(m=Date.now(),o||(y=setTimeout(g?A:L,t))):L():o!==!0&&(y=setTimeout(g?A:L,g===void 0?t-T:t))}return M.cancel=k,M}function Xt(t,n){return Math.sqrt(ot(t,n))}function ot(t,n){return Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)}function Yt(t,n,a){const l=ot(n,a);if(l===0)return ot(t,n);let s=((t[0]-n[0])*(a[0]-n[0])+(t[1]-n[1])*(a[1]-n[1]))/l;return s=Math.max(0,Math.min(1,s)),ot(t,O(n,a,s))}function O(t,n,a){return[t[0]+(n[0]-t[0])*a,t[1]+(n[1]-t[1])*a]}function jt(t,n){const a=t[n+0],l=t[n+1],s=t[n+2],o=t[n+3];let r=3*l[0]-2*a[0]-o[0];r*=r;let c=3*l[1]-2*a[1]-o[1];c*=c;let u=3*s[0]-2*o[0]-a[0];u*=u;let g=3*s[1]-2*o[1]-a[1];return g*=g,r<u&&(r=u),c<g&&(c=g),r+c}function ut(t,n,a,l){const s=l||[];if(jt(t,n)<a){const o=t[n+0];s.length?Xt(s[s.length-1],o)>1&&s.push(o):s.push(o),s.push(t[n+3])}else{const r=t[n+0],c=t[n+1],u=t[n+2],g=t[n+3],y=O(r,c,.5),f=O(c,u,.5),m=O(u,g,.5),D=O(y,f,.5),k=O(f,m,.5),M=O(D,k,.5);ut([r,y,D,M],0,a,s),ut([M,k,m,g],0,a,s)}return s}function ft(t,n,a,l,s){const o=s||[],r=t[n],c=t[a-1];let u=0,g=1;for(let y=n+1;y<a-1;++y){const f=Yt(t[y],r,c);f>u&&(u=f,g=y)}return Math.sqrt(u)>l?(ft(t,n,g+1,l,o),ft(t,g,a,l,o)):(o.length||o.push(r),o.push(c)),o}function Gt(t,n=.15,a){const l=[],s=(t.length-1)/3;for(let o=0;o<s;o++){const r=o*3;ut(t,r,n,l)}return a&&a>0?ft(l,0,l.length,a):l}function G(t){return[...t]}function Ut(t,n=0){const a=t.length;if(a<3)throw new Error("A curve must have at least three points.");const l=[];if(a===3)l.push(G(t[0]),G(t[1]),G(t[2]),G(t[2]));else{const s=[];s.push(t[0],t[0]);for(let c=1;c<t.length;c++)s.push(t[c]),c===t.length-1&&s.push(t[c]);const o=[],r=1-n;l.push(G(s[0]));for(let c=1;c+2<s.length;c++){const u=s[c];o[0]=[u[0],u[1]],o[1]=[u[0]+(r*s[c+1][0]-r*s[c-1][0])/6,u[1]+(r*s[c+1][1]-r*s[c-1][1])/6],o[2]=[s[c+1][0]+(r*s[c][0]-r*s[c+2][0])/6,s[c+1][1]+(r*s[c][1]-r*s[c+2][1])/6],o[3]=[s[c+1][0],s[c+1][1]],l.push(o[1],o[2],o[3])}}return l}const Qt=[[[3152.059889126087,1582.2779244897192],[2958.577498253122,2456.481932374286],[3123.205653211,3306.4157758369984],[4135.970029298883,3554.4187314194864],[2373.7907435462075,4016.999941682505]],[[0,0]],[[0,0]],[[0,0]]],st=(t,n,a,l)=>{var s=n-t,o=l-a;return Math.sqrt(s*s+o*o)};function _t(t,n,a){const l=t.slice();return l[35]=n[a],l[37]=a,l}function xt(t){let n,a=t[1][t[37]].pathString+"",l;return{c(){n=U("pre"),l=Vt(a),this.h()},l(s){n=Q(s,"PRE",{class:!0});var o=Z(n);l=Kt(o,a),o.forEach(z),this.h()},h(){E(n,"class","svelte-16xin6")},m(s,o){dt(s,n,o),J(n,l)},p(s,o){o[0]&2&&a!==(a=s[1][s[37]].pathString+"")&&Ft(l,a)},d(s){s&&z(n)}}}function Mt(t){let n,a,l,s,o,r,c,u,g,y,f,m=t[3]&&xt(t);function D(...M){return t[13](t[37],...M)}function k(...M){return t[14](t[37],...M)}return{c(){n=U("div"),m&&m.c(),a=lt(),l=U("canvas"),o=lt(),r=U("canvas"),u=lt(),this.h()},l(M){n=Q(M,"DIV",{id:!0,class:!0,style:!0});var _=Z(n);m&&m.l(_),a=ct(_),l=Q(_,"CANVAS",{id:!0,class:!0,style:!0}),Z(l).forEach(z),o=ct(_),r=Q(_,"CANVAS",{id:!0,class:!0,style:!0}),Z(r).forEach(z),u=ct(_),_.forEach(z),this.h()},h(){E(l,"id","map"+t[37]),E(l,"class","map svelte-16xin6"),E(l,"style",s=t[2][t[37]]+(t[3]?"height: 95%;":"")),E(r,"id","view"+t[37]),E(r,"class","view svelte-16xin6"),E(r,"style",c=t[3]?"height: 95%;":""),E(n,"id","viewport"+t[37]),E(n,"class","viewport svelte-16xin6"),E(n,"style",g=t[0]<0||t[0]==t[37]?"":"display: none")},m(M,_){dt(M,n,_),m&&m.m(n,null),J(n,a),J(n,l),J(n,o),J(n,r),J(n,u),y||(f=[at(r,"mousedown",D),at(r,"mousemove",Jt(40,k))],y=!0)},p(M,_){t=M,t[3]?m?m.p(t,_):(m=xt(t),m.c(),m.m(n,a)):m&&(m.d(1),m=null),_[0]&12&&s!==(s=t[2][t[37]]+(t[3]?"height: 95%;":""))&&E(l,"style",s),_[0]&8&&c!==(c=t[3]?"height: 95%;":"")&&E(r,"style",c),_[0]&1&&g!==(g=t[0]<0||t[0]==t[37]?"":"display: none")&&E(n,"style",g)},d(M){M&&z(n),m&&m.d(),y=!1,bt(f)}}}function Zt(t){let n,a,l,s=[...Array(R).keys()],o=[];for(let r=0;r<s.length;r+=1)o[r]=Mt(_t(t,s,r));return{c(){n=U("div");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){n=Q(r,"DIV",{class:!0,style:!0});var c=Z(n);for(let u=0;u<o.length;u+=1)o[u].l(c);c.forEach(z),this.h()},h(){E(n,"class","views svelte-16xin6"),E(n,"style",t[4])},m(r,c){dt(r,n,c);for(let u=0;u<o.length;u+=1)o[u].m(n,null);a||(l=[at(window,"keydown",vt(t[5])),at(window,"keyup",vt(t[6]))],a=!0)},p(r,c){if(c[0]&399){s=[...Array(R).keys()];let u;for(u=0;u<s.length;u+=1){const g=_t(r,s,u);o[u]?o[u].p(g,c):(o[u]=Mt(g),o[u].c(),o[u].m(n,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}c[0]&16&&E(n,"style",r[4])},i:wt,o:wt,d(r){r&&z(n),Nt(o,r),a=!1,bt(l)}}}const $t=.2,Ct=400,te=10,ee=.7,R=4;let St=240,Pt=100,Et=1.1;const ht=20;function ne(t,n,a){let l,s,o,r,c,u;const g=[],y=[],f=[];let m,D,k,M,_,W,b,I;const T={},L={};let A=-1;const qt=h=>{var i,e,d,C,w,x;for(let v=0;v<y.length;v++){if(A>=0&&v!=A)continue;const S=y[v],p=f[v];let{x:q,y:P,zoom:H}=S;const V=(i=T.e)!=null?i:0,X=(e=T.q)!=null?e:0,Y=V-X,Rt=Math.pow(1+Y*$t,h);if(H*=Rt,T.r&&(p.pathIndex=0,p.x=p.path[0][0],p.y=p.path[0][1]),L.v&&p.pathIndex<p.path.length-1){let j=p.pathLength/te*h;for(;j>0&&p.pathIndex<p.path.length-1;){let tt=p.pathIndex,et=p.path[tt+1][0],K=p.path[tt+1][1];const N=st(p.x,et,p.y,K);if(N>0&&(p.course=Math.atan2(K-p.y,et-p.x)),N==0){p.pathIndex++;continue}const F=Math.min(j,N),nt=Math.cos(p.course),zt=Math.sin(p.course);p.x+=nt*F,p.y+=zt*F,j-=F}}if(L.f){const B=ee*h;q=p.x*B+q*(1-B),P=p.y*B+P*(1-B)}else{const B=(d=T.a)!=null?d:0,j=(C=T.d)!=null?C:0,tt=(w=T.s)!=null?w:0,et=(x=T.w)!=null?x:0,K=j-B,N=et-tt,F=Math.sqrt(K*K+N*N),nt=F>0?1/F:0;q+=nt*K*Ct*h,P-=nt*N*Ct*h}S.x=q,S.y=P,S.zoom=H}T.r=!1},kt=()=>{const h=m.width/k.width;I.clearRect(0,0,b.width,b.height),f.forEach(i=>{I.beginPath(),I.fillStyle=i.color;const e=i.x+Math.cos(i.course)*20,d=i.y+Math.sin(i.course)*20,C=i.x+Math.cos(i.course+Math.PI/1.5)*20,w=i.y+Math.sin(i.course+Math.PI/1.5)*20,x=i.x+Math.cos(i.course-Math.PI/1.5)*20,v=i.y+Math.sin(i.course-Math.PI/1.5)*20;I.moveTo(e,d),I.lineTo(C,w),I.lineTo(i.x,i.y),I.lineTo(x,v),I.fill()}),y.forEach(({x:i,y:e,zoom:d,canvas:C,context:w,map:x})=>{const v=x.canvas.width=C.width=C.offsetWidth,S=x.canvas.height=C.height=C.offsetHeight;d*=A>=0?Math.ceil(Math.sqrt(R)):1;const p=d>.8,q=p?m:k,P=p?h:1,H=v/d,V=S/d,X=i-H*.5,Y=e-V*.5;u&&w.drawImage(_,X,Y,H,V,0,0,v,S),w.drawImage(b,X,Y,H,V,0,0,v,S),x.context.drawImage(q,X*P,Y*P,H*P,V*P,0,0,v,S)})};let gt;const pt=h=>{const i=h-gt;i>0&&(qt(i/1e3),kt()),gt=h,requestAnimationFrame(pt)},It=h=>{T[h.key.toLowerCase()]=1,a(9,L[h.key.toLowerCase()]=!L[h.key.toLowerCase()],L);let i=parseInt(h.key)-1;i==A||i>=R?a(0,A=-1):a(0,A=isNaN(i)?A:i)},Tt=h=>{T[h.key.toLowerCase()]=0},$=[];for(let h=0;h<R;h++)$.push(`filter: hue-rotate(${St}deg) invert(${Pt}%) saturate(${Et});`);Ot(()=>{m=document.createElement("canvas"),D=m.getContext("2d"),k=document.createElement("canvas"),M=k.getContext("2d"),_=document.createElement("canvas"),W=_.getContext("2d"),b=document.createElement("canvas"),I=b.getContext("2d");for(let e=0;e<R;e++){g.push({}),g[e].canvas=document.getElementById(`map${e}`),g[e].context=g[e].canvas.getContext("2d"),f.push({points:Qt[e],path:[],pathIndex:0,pathLength:0,pathString:"",editing:-1,color:Lt[e]}),rt(e,!0),a(1,f[e].x=f[e].path[0]?f[e].path[0][0]:0,f),a(1,f[e].y=f[e].path[0]?f[e].path[0][1]:0,f);const d=f[e].path[1]?f[e].path[1][0]:f[e].x,C=f[e].path[1]?f[e].path[1][1]:f[e].y;a(1,f[e].course=Math.atan2(C-f[e].y,d-f[e].x),f),y.push({x:f[e].x,y:f[e].y,zoom:4,map:g[e],ship:f[e]}),y[e].canvas=document.getElementById(`view${e}`),y[e].context=y[e].canvas.getContext("2d"),y.forEach(({canvas:w,map:x})=>{x.canvas.width=w.width=w.offsetWidth,x.canvas.height=w.height=w.offsetHeight})}const h=new Image;h.src="/harbor/chart-5000.png",h.onload=()=>{k.width=h.naturalWidth,k.height=h.naturalHeight,_.width=h.naturalWidth,_.height=h.naturalHeight,b.width=h.naturalWidth,b.height=h.naturalHeight,M.drawImage(h,0,0),g.forEach(({canvas:e,context:d})=>{const C=e.width,w=e.height;d.drawImage(k,0,0,C,w,0,0,C,w)}),it()};const i=new Image;i.src="/harbor/chart-10000.png",i.onload=()=>{m.width=i.naturalWidth,m.height=i.naturalHeight,D.drawImage(i,0,0)},requestAnimationFrame(pt)});const Lt=["#ff00d7","#c9ff00","#ff9900","#0982ff"],it=()=>{const h=_,i=W;i.clearRect(0,0,h.width,h.height),f.forEach(({points:e,path:d,color:C})=>{if(d.length>0){i.beginPath(),i.lineWidth=3,i.strokeStyle=C,i.setLineDash([12,3]);let w=d[0][0],x=d[0][1];i.moveTo(w,x);for(let v=1;v<d.length;v++)w=d[v][0],x=d[v][1],i.lineTo(w,x);i.stroke();for(let v=0;v<e.length;v++)w=e[v][0],x=e[v][1],i.beginPath(),i.arc(w,x,ht,0,2*Math.PI),i.stroke()}})},rt=(h,i)=>{const e=f[h];if(e.points.length>3){const d=Ut(e.points);e.path=Gt(d,.8,1)}else e.path=e.points;e.pathLength=0;for(let d=1;d<e.path.length;d++)e.pathLength+=st(e.path[d-1][0],e.path[d][0],e.path[d-1][1],e.path[d][1]);i&&(e.pathString=JSON.stringify(e.points))},mt=(h,i)=>{if(!u)return;const e=f[i],{x:d,y:C,zoom:w,canvas:x}=y[i],v=d+(h.offsetX-x.width*.5)/w,S=C+(h.offsetY-x.height*.5)/w;if(h.button==0){if(e.editing>=0){let q=-1;for(let P=0;P<e.points.length;P++)if(Math.abs(P-e.editing)==1){var p=st(e.points[P][0],v,e.points[P][1],S);p<ht&&(q=P)}q<0?e.points[e.editing]=[v,S]:e.points.splice(e.editing,1),e.editing=-1}else{for(let q=0;q<e.points.length;q++){var p=st(e.points[q][0],v,e.points[q][1],S);p<ht&&(e.editing=q)}e.editing<0&&e.points.push([v,S])}rt(i,!0),it()}},yt=(h,i)=>{if(!u)return;const e=f[i],{x:d,y:C,zoom:w,canvas:x}=y[i],v=d+(h.offsetX-x.width*.5)/w,S=C+(h.offsetY-x.height*.5)/w;e.editing>=0&&(e.points[e.editing]=[v,S],rt(i),it())},At=(h,i)=>mt(i,h),Dt=(h,i)=>yt(i,h);t.$$.update=()=>{t.$$.dirty[0]&1&&a(10,l=A>=0?1:Math.ceil(Math.sqrt(R))),t.$$.dirty[0]&1024&&a(12,s=100/l),t.$$.dirty[0]&4096&&a(11,o=`${s}% `),t.$$.dirty[0]&3072&&a(4,r=`
	grid-template-columns: ${o.repeat(l)};
	grid-template-rows: ${o.repeat(l)};`),t.$$.dirty[0]&512&&a(3,c=L.c),t.$$.dirty[0]&512&&(u=!L.p)};for(let h=0;h<R;h++)a(2,$[h]=`filter: hue-rotate(${St}deg) invert(${Pt}%) saturate(${Et});`,$);return[A,f,$,c,r,It,Tt,mt,yt,L,l,o,s,At,Dt]}class oe extends Wt{constructor(n){super(),Ht(this,n,ne,Zt,Bt,{},null,[-1,-1])}}export{oe as default};
