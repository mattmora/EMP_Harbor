import{S as jt,i as Bt,s as Ot,k as Q,l as Z,m as $,h as W,n as q,b as yt,I as it,B as St,J as Ut,K as It,o as Vt,A as Ft,L as Kt,a as dt,c as ft,G as K,q as Jt,r as Xt,u as Yt}from"../../chunks/index-a6ab4251.js";function Lt(t,e,a){var u=a||{},n=u.noTrailing,s=n===void 0?!1:n,i=u.noLeading,l=i===void 0?!1:i,d=u.debounceMode,y=d===void 0?void 0:d,v,M=!1,h=0;function k(){v&&clearTimeout(v)}function N(S){var A=S||{},D=A.upcomingOnly,R=D===void 0?!1:D;k(),M=!R}function _(){for(var S=arguments.length,A=new Array(S),D=0;D<S;D++)A[D]=arguments[D];var R=this,I=Date.now()-h;if(M)return;function E(){h=Date.now(),e.apply(R,A)}function T(){v=void 0}!l&&y&&!v&&E(),k(),y===void 0&&I>t?l?(h=Date.now(),s||(v=setTimeout(y?T:E,t))):E():s!==!0&&(v=setTimeout(y?T:E,y===void 0?t-I:t))}return _.cancel=N,_}function Gt(t,e){return Math.sqrt(at(t,e))}function at(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function Qt(t,e,a){const u=at(e,a);if(u===0)return at(t,e);let n=((t[0]-e[0])*(a[0]-e[0])+(t[1]-e[1])*(a[1]-e[1]))/u;return n=Math.max(0,Math.min(1,n)),at(t,O(e,a,n))}function O(t,e,a){return[t[0]+(e[0]-t[0])*a,t[1]+(e[1]-t[1])*a]}function Zt(t,e){const a=t[e+0],u=t[e+1],n=t[e+2],s=t[e+3];let i=3*u[0]-2*a[0]-s[0];i*=i;let l=3*u[1]-2*a[1]-s[1];l*=l;let d=3*n[0]-2*s[0]-a[0];d*=d;let y=3*n[1]-2*s[1]-a[1];return y*=y,i<d&&(i=d),l<y&&(l=y),i+l}function pt(t,e,a,u){const n=u||[];if(Zt(t,e)<a){const s=t[e+0];n.length?Gt(n[n.length-1],s)>1&&n.push(s):n.push(s),n.push(t[e+3])}else{const i=t[e+0],l=t[e+1],d=t[e+2],y=t[e+3],v=O(i,l,.5),M=O(l,d,.5),h=O(d,y,.5),k=O(v,M,.5),N=O(M,h,.5),_=O(k,N,.5);pt([i,v,k,_],0,a,n),pt([_,N,h,y],0,a,n)}return n}function mt(t,e,a,u,n){const s=n||[],i=t[e],l=t[a-1];let d=0,y=1;for(let v=e+1;v<a-1;++v){const M=Qt(t[v],i,l);M>d&&(d=M,y=v)}return Math.sqrt(d)>u?(mt(t,e,y+1,u,s),mt(t,y,a,u,s)):(s.length||s.push(i),s.push(l)),s}function $t(t,e=.15,a){const u=[],n=(t.length-1)/3;for(let s=0;s<n;s++){const i=s*3;pt(t,i,e,u)}return a&&a>0?mt(u,0,u.length,a):u}function G(t){return[...t]}function te(t,e=0){const a=t.length;if(a<3)throw new Error("A curve must have at least three points.");const u=[];if(a===3)u.push(G(t[0]),G(t[1]),G(t[2]),G(t[2]));else{const n=[];n.push(t[0],t[0]);for(let l=1;l<t.length;l++)n.push(t[l]),l===t.length-1&&n.push(t[l]);const s=[],i=1-e;u.push(G(n[0]));for(let l=1;l+2<n.length;l++){const d=n[l];s[0]=[d[0],d[1]],s[1]=[d[0]+(i*n[l+1][0]-i*n[l-1][0])/6,d[1]+(i*n[l+1][1]-i*n[l-1][1])/6],s[2]=[n[l+1][0]+(i*n[l][0]-i*n[l+2][0])/6,n[l+1][1]+(i*n[l][1]-i*n[l+2][1])/6],s[3]=[n[l+1][0],n[l+1][1]],u.push(s[1],s[2],s[3])}}return u}const Ct=[[[3673.66,982.15],[3160.41,2009.65],[2259.87,4033.8],[2728.49,4750.87],[3465.49,5002.21],[3826.81,5836.37],[4283.84,5983.17]],[[4500,500],[2500,3280]],[[500,6060],[2500,3280]],[[4500,6060],[2500,3280]]],ot=(t,e,a,u)=>{var n=e-t,s=u-a;return Math.sqrt(n*n+s*s)};const{window:Pt}=Kt;function bt(t,e,a){const u=t.slice();return u[40]=e[a],u[42]=a,u}function qt(t){let e,a=t[2][t[42]].pathString+"",u;return{c(){e=Q("pre"),u=Jt(a),this.h()},l(n){e=Z(n,"PRE",{class:!0});var s=$(e);u=Xt(s,a),s.forEach(W),this.h()},h(){q(e,"class","svelte-cedt8j")},m(n,s){yt(n,e,s),K(e,u)},p(n,s){s[0]&4&&a!==(a=n[2][n[42]].pathString+"")&&Yt(u,a)},d(n){n&&W(e)}}}function Et(t){let e,a,u,n,s,i,l,d,y,v,M,h=t[3]&&qt(t);function k(..._){return t[15](t[42],..._)}function N(..._){return t[16](t[42],..._)}return{c(){e=Q("div"),h&&h.c(),a=dt(),u=Q("canvas"),s=dt(),i=Q("canvas"),d=dt(),this.h()},l(_){e=Z(_,"DIV",{id:!0,class:!0,style:!0});var S=$(e);h&&h.l(S),a=ft(S),u=Z(S,"CANVAS",{id:!0,class:!0,style:!0}),$(u).forEach(W),s=ft(S),i=Z(S,"CANVAS",{id:!0,class:!0,style:!0}),$(i).forEach(W),d=ft(S),S.forEach(W),this.h()},h(){q(u,"id","map"+t[42]),q(u,"class","map svelte-cedt8j"),q(u,"style",n=t[1][t[42]]+(t[3]?"height: 95%;":"")),q(i,"id","view"+t[42]),q(i,"class","view svelte-cedt8j"),q(i,"style",l=t[3]?"height: 95%;":""),q(e,"id","viewport"+t[42]),q(e,"class","viewport svelte-cedt8j"),q(e,"style",y=t[0]<0||t[0]==t[42]?"":"display: none")},m(_,S){yt(_,e,S),h&&h.m(e,null),K(e,a),K(e,u),K(e,s),K(e,i),K(e,d),v||(M=[it(i,"mousedown",k),it(i,"mousemove",Lt(40,N))],v=!0)},p(_,S){t=_,t[3]?h?h.p(t,S):(h=qt(t),h.c(),h.m(e,a)):h&&(h.d(1),h=null),S[0]&10&&n!==(n=t[1][t[42]]+(t[3]?"height: 95%;":""))&&q(u,"style",n),S[0]&8&&l!==(l=t[3]?"height: 95%;":"")&&q(i,"style",l),S[0]&1&&y!==(y=t[0]<0||t[0]==t[42]?"":"display: none")&&q(e,"style",y)},d(_){_&&W(e),h&&h.d(),v=!1,It(M)}}}function ee(t){let e,a,u,n=t[4],s=[];for(let i=0;i<n.length;i+=1)s[i]=Et(bt(t,n,i));return{c(){e=Q("div");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=Z(i,"DIV",{class:!0,style:!0});var l=$(e);for(let d=0;d<s.length;d+=1)s[d].l(l);l.forEach(W),this.h()},h(){q(e,"class","views svelte-cedt8j"),q(e,"style",t[5])},m(i,l){yt(i,e,l);for(let d=0;d<s.length;d+=1)s[d].m(e,null);a||(u=[it(Pt,"keydown",t[6]),it(Pt,"keyup",t[7])],a=!0)},p(i,l){if(l[0]&799){n=i[4];let d;for(d=0;d<n.length;d+=1){const y=bt(i,n,d);s[d]?s[d].p(y,l):(s[d]=Et(y),s[d].c(),s[d].m(e,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=n.length}l[0]&32&&q(e,"style",i[5])},i:St,o:St,d(i){i&&W(e),Ut(s,i),a=!1,It(u)}}}const ne=.2,kt=400;let se=180,oe=100,ae=1;const gt=20;function ie(t,e,a){let u,n,s,i,l,d,y;const v=[],M=[],h=[];let k,N,_,S,A,D,R,I;const E={},T={};let rt=420,lt=.03,ht="dot",z=-1;const Rt=f=>{var o,c,m,P,r,x;for(let p=0;p<M.length;p++){const w=M[p],g=h[p];let{x:b,y:C,zoom:H}=w;const U=(o=E.e)!=null?o:0,J=(c=E.q)!=null?c:0,X=U-J,Wt=Math.pow(1+X*ne,f);if(H*=Wt,E.r&&(g.pathIndex=0,g.x=g.path[0][0],g.y=g.path[0][1]),T.v&&g.pathIndex<g.path.length-1){let Y=g.pathLength/rt*f;for(;Y>0&&g.pathIndex<g.path.length-1;){let et=g.pathIndex,nt=g.path[et+1][0],V=g.path[et+1][1];const B=ot(g.x,nt,g.y,V);if(B>0&&(g.course=Math.atan2(V-g.y,nt-g.x)),B==0){g.pathIndex++;continue}const F=Math.min(Y,B),st=Math.cos(g.course),Ht=Math.sin(g.course);g.x+=st*F,g.y+=Ht*F,Y-=F}}if(T.f){if(z<0||p==z){const j=(m=E.a)!=null?m:0,Y=(P=E.d)!=null?P:0,et=(r=E.s)!=null?r:0,nt=(x=E.w)!=null?x:0,V=Y-j,B=nt-et,F=Math.sqrt(V*V+B*B),st=F>0?1/F:0;b+=st*V*kt*f,C-=st*B*kt*f}}else{const j=lt;b=g.x*j+b*(1-j),C=g.y*j+C*(1-j)}w.x=b,w.y=C,w.zoom=H}E.r=!1},Tt=()=>{const f=k.width/_.width;I.clearRect(0,0,R.width,R.height),h.forEach(o=>{if(I.beginPath(),I.fillStyle=o.color,ht==="arrow"){const c=o.x+Math.cos(o.course)*20,m=o.y+Math.sin(o.course)*20,P=o.x+Math.cos(o.course+Math.PI/1.5)*20,r=o.y+Math.sin(o.course+Math.PI/1.5)*20,x=o.x+Math.cos(o.course-Math.PI/1.5)*20,p=o.y+Math.sin(o.course-Math.PI/1.5)*20;I.moveTo(c,m),I.lineTo(P,r),I.lineTo(o.x,o.y),I.lineTo(x,p)}else I.arc(o.x,o.y,8,0,2*Math.PI);I.fill()}),M.forEach(({x:o,y:c,zoom:m,canvas:P,context:r,map:x})=>{const p=x.canvas.width=P.width=P.offsetWidth,w=x.canvas.height=P.height=P.offsetHeight;m*=z>=0?Math.ceil(Math.sqrt(L)):1;const g=m>.8,b=g?k:_,C=g?f:1,H=p/m,U=w/m,J=o-H*.5,X=c-U*.5;y&&r.drawImage(A,J,X,H,U,0,0,p,w),r.drawImage(R,J,X,H,U,0,0,p,w),x.context.drawImage(b,J*C,X*C,H*C,U*C,0,0,p,w)})};let wt;const vt=Lt(0,f=>{const o=f-wt;o>0&&(Rt(o/1e3),Tt()),wt=f,requestAnimationFrame(vt)}),At=f=>{E[f.key.toLowerCase()]=1,a(10,T[f.key.toLowerCase()]=!T[f.key.toLowerCase()],T);let o=parseInt(f.key)-1;o==z||o>=L?a(0,z=-1):a(0,z=isNaN(o)?z:o),tt()},zt=f=>{E[f.key.toLowerCase()]=0};let L=1,ct;Vt(async()=>{var m,P;const f={views:parseInt(new URLSearchParams(window.location.search).get("views")),follow:parseFloat(new URLSearchParams(window.location.search).get("follow")),duration:parseFloat(new URLSearchParams(window.location.search).get("duration")),shape:new URLSearchParams(window.location.search).get("shape")};a(11,L=isNaN(f.views)?L:f.views),a(4,u=[...Array(L).keys()]),lt=isNaN(f.follow)?lt:f.follow,rt=isNaN(f.duration)?rt:f.duration,ht=(m=f.shape)!=null?m:ht,await Ft(),k=document.createElement("canvas"),N=k.getContext("2d"),_=document.createElement("canvas"),S=_.getContext("2d"),A=document.createElement("canvas"),D=A.getContext("2d"),R=document.createElement("canvas"),I=R.getContext("2d");for(let r=0;r<L;r++){v.push({}),v[r].canvas=document.getElementById(`map${r}`),v[r].context=v[r].canvas.getContext("2d"),h.push({points:(P=Ct[r%Ct.length])!=null?P:[],path:[],pathIndex:0,pathLength:0,pathString:"",editing:-1,color:_t[r%_t.length]}),ut(r,!0),a(2,h[r].x=h[r].path[0]?h[r].path[0][0]:-1,h),a(2,h[r].y=h[r].path[0]?h[r].path[0][1]:-1,h);const x=h[r].path[1]?h[r].path[1][0]:h[r].x,p=h[r].path[1]?h[r].path[1][1]:h[r].y;a(2,h[r].course=Math.atan2(p-h[r].y,x-h[r].x),h),M.push({x:h[r].x,y:h[r].y,map:v[r],ship:h[r]}),M[r].canvas=document.getElementById(`view${r}`),M[r].context=M[r].canvas.getContext("2d"),M[r].zoom=3*R.width/M[r].canvas.width,M.forEach(w=>{const{canvas:g,map:b,zoom:C}=w;b.canvas.width=g.width=g.offsetWidth,b.canvas.height=g.height=g.offsetHeight,w.x=w.x<0?g.width/C*.5:w.x,w.y=w.y<0?g.height/C*.5:w.y})}const o=new Image;o.src="/harbor/chart-5000.png",o.onload=()=>{_.width=o.naturalWidth,_.height=o.naturalHeight,A.width=o.naturalWidth,A.height=o.naturalHeight,R.width=o.naturalWidth,R.height=o.naturalHeight,S.drawImage(o,0,0),v.forEach(({canvas:r,context:x})=>{const p=r.width,w=r.height;x.drawImage(_,0,0,p,w,0,0,p,w)}),tt()};const c=new Image;c.src="/harbor/chart-10000.png",c.onload=()=>{k.width=c.naturalWidth,k.height=c.naturalHeight,N.drawImage(c,0,0)},requestAnimationFrame(vt)});const _t=["#ff00dd","#ff9900","#11ff00","#1188ff"],tt=()=>{const f=A,o=D;o.clearRect(0,0,f.width,f.height),h.forEach(({points:c,path:m,color:P})=>{if(m.length>0){o.beginPath(),o.lineWidth=3,o.strokeStyle=P,o.setLineDash([12,3]);let r=m[0][0],x=m[0][1];o.moveTo(r,x);for(let p=1;p<m.length;p++)r=m[p][0],x=m[p][1],o.lineTo(r,x);o.stroke();for(let p=0;p<c.length;p++)r=c[p][0],x=c[p][1],o.beginPath(),(!T.o||p==0||p==c.length-1)&&o.arc(r,x,gt,0,2*Math.PI),o.stroke()}})},ut=(f,o)=>{const c=h[f];if(c.points.length>3){const m=te(c.points);c.path=$t(m,.8,1)}else c.path=c.points;c.pathLength=0;for(let m=1;m<c.path.length;m++)c.pathLength+=ot(c.path[m-1][0],c.path[m][0],c.path[m-1][1],c.path[m][1]);o&&(c.pathString=JSON.stringify(c.points))},Mt=(f,o)=>{if(!y)return;const c=h[o];let{x:m,y:P,zoom:r,canvas:x}=M[o];r*=z>=0?Math.ceil(Math.sqrt(L)):1;const p=m+(f.offsetX-x.width*.5)/r,w=P+(f.offsetY-x.height*.5)/r;if(f.button==0){if(c.editing>=0){let b=-1;for(let C=0;C<c.points.length;C++)if(Math.abs(C-c.editing)==1){var g=ot(c.points[C][0],p,c.points[C][1],w);g<gt&&(b=C)}b<0?c.points[c.editing]=[p,w]:c.points.splice(c.editing,1),c.editing=-1}else{for(let b=0;b<c.points.length;b++){var g=ot(c.points[b][0],p,c.points[b][1],w);g<gt&&(c.editing=b)}c.editing<0&&c.points.push([p,w])}ut(o,!0),tt()}},xt=(f,o)=>{if(!y)return;const c=h[o];let{x:m,y:P,zoom:r,canvas:x}=M[o];r*=z>=0?Math.ceil(Math.sqrt(L)):1;const p=m+(f.offsetX-x.width*.5)/r,w=P+(f.offsetY-x.height*.5)/r;c.editing>=0&&(c.points[c.editing]=[p,w],ut(o),tt())},Dt=(f,o)=>Mt(o,f),Nt=(f,o)=>xt(o,f);return t.$$.update=()=>{if(t.$$.dirty[0]&2048&&a(4,u=[...Array(L).keys()]),t.$$.dirty[0]&2049&&a(12,n=z>=0?1:Math.ceil(Math.sqrt(L))),t.$$.dirty[0]&4096&&a(14,s=100/n),t.$$.dirty[0]&16384&&a(13,i=`${s}% `),t.$$.dirty[0]&12288&&a(5,l=`
	grid-template-columns: ${i.repeat(n)};
	grid-template-rows: ${i.repeat(n)};`),t.$$.dirty[0]&2050){a(1,ct=[]);for(let f=0;f<L;f++)ct.push(`filter: hue-rotate(${se+f*(360/L)*1}deg) invert(${oe}%) saturate(${ae});`)}t.$$.dirty[0]&1024&&a(3,d=T.c),t.$$.dirty[0]&1024&&(y=!T.p)},[z,ct,h,d,u,l,At,zt,Mt,xt,T,L,n,i,s,Dt,Nt]}class le extends jt{constructor(e){super(),Bt(this,e,ie,ee,Ot,{},null,[-1,-1])}}export{le as default};
