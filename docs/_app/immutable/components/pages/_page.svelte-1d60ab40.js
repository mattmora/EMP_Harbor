import{S as Pt,i as zt,s as xt,k as N,l as K,m as F,h as x,n as E,b as ot,I as U,J as pt,B as mt,K as At,L as bt,o as Rt,a as tt,c as et,G as B,q as Tt,r as Dt,u as Lt}from"../../chunks/index-e4a90c97.js";function $t(t,e,r){var c=r||{},s=c.noTrailing,o=s===void 0?!1:s,n=c.noLeading,i=n===void 0?!1:n,l=c.debounceMode,f=l===void 0?void 0:l,w,d=!1,b=0;function C(){w&&clearTimeout(w)}function p(L){var A=L||{},M=A.upcomingOnly,O=M===void 0?!1:M;C(),d=!O}function m(){for(var L=arguments.length,A=new Array(L),M=0;M<L;M++)A[M]=arguments[M];var O=this,J=Date.now()-b;if(d)return;function P(){b=Date.now(),e.apply(O,A)}function j(){w=void 0}!i&&f&&!w&&P(),C(),f===void 0&&J>t?i?(b=Date.now(),o||(w=setTimeout(f?j:P,t))):P():o!==!0&&(w=setTimeout(f?j:P,f===void 0?t-J:t))}return m.cancel=p,m}function Wt(t,e){return Math.sqrt(G(t,e))}function G(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function Bt(t,e,r){const c=G(e,r);if(c===0)return G(t,e);let s=((t[0]-e[0])*(r[0]-e[0])+(t[1]-e[1])*(r[1]-e[1]))/c;return s=Math.max(0,Math.min(1,s)),G(t,D(e,r,s))}function D(t,e,r){return[t[0]+(e[0]-t[0])*r,t[1]+(e[1]-t[1])*r]}function Ht(t,e){const r=t[e+0],c=t[e+1],s=t[e+2],o=t[e+3];let n=3*c[0]-2*r[0]-o[0];n*=n;let i=3*c[1]-2*r[1]-o[1];i*=i;let l=3*s[0]-2*o[0]-r[0];l*=l;let f=3*s[1]-2*o[1]-r[1];return f*=f,n<l&&(n=l),i<f&&(i=f),n+i}function nt(t,e,r,c){const s=c||[];if(Ht(t,e)<r){const o=t[e+0];s.length?Wt(s[s.length-1],o)>1&&s.push(o):s.push(o),s.push(t[e+3])}else{const n=t[e+0],i=t[e+1],l=t[e+2],f=t[e+3],w=D(n,i,.5),d=D(i,l,.5),b=D(l,f,.5),C=D(w,d,.5),p=D(d,b,.5),m=D(C,p,.5);nt([n,w,C,m],0,r,s),nt([m,p,b,f],0,r,s)}return s}function st(t,e,r,c,s){const o=s||[],n=t[e],i=t[r-1];let l=0,f=1;for(let w=e+1;w<r-1;++w){const d=Bt(t[w],n,i);d>l&&(l=d,f=w)}return Math.sqrt(l)>c?(st(t,e,f+1,c,o),st(t,f,r,c,o)):(o.length||o.push(n),o.push(i)),o}function Ot(t,e=.15,r){const c=[],s=(t.length-1)/3;for(let o=0;o<s;o++){const n=o*3;nt(t,n,e,c)}return r&&r>0?st(c,0,c.length,r):c}function I(t){return[...t]}function Vt(t,e=0){const r=t.length;if(r<3)throw new Error("A curve must have at least three points.");const c=[];if(r===3)c.push(I(t[0]),I(t[1]),I(t[2]),I(t[2]));else{const s=[];s.push(t[0],t[0]);for(let i=1;i<t.length;i++)s.push(t[i]),i===t.length-1&&s.push(t[i]);const o=[],n=1-e;c.push(I(s[0]));for(let i=1;i+2<s.length;i++){const l=s[i];o[0]=[l[0],l[1]],o[1]=[l[0]+(n*s[i+1][0]-n*s[i-1][0])/6,l[1]+(n*s[i+1][1]-n*s[i-1][1])/6],o[2]=[s[i+1][0]+(n*s[i][0]-n*s[i+2][0])/6,s[i+1][1]+(n*s[i][1]-n*s[i+2][1])/6],o[3]=[s[i+1][0],s[i+1][1]],c.push(o[1],o[2],o[3])}}return c}const It=[[[3152.059889126087,1582.2779244897192],[2958.577498253122,2456.481932374286],[3123.205653211,3306.4157758369984],[4135.970029298883,3554.4187314194864],[2373.7907435462075,4016.999941682505]],[],[],[]];function vt(t,e,r){const c=t.slice();return c[31]=e[r],c[33]=r,c}function wt(t){let e,r=t[0][t[33]].pathString+"",c;return{c(){e=N("pre"),c=Tt(r),this.h()},l(s){e=K(s,"PRE",{class:!0});var o=F(e);c=Dt(o,r),o.forEach(x),this.h()},h(){E(e,"class","svelte-11i875g")},m(s,o){ot(s,e,o),B(e,c)},p(s,o){o[0]&1&&r!==(r=s[0][s[33]].pathString+"")&&Lt(c,r)},d(s){s&&x(e)}}}function _t(t){let e,r,c,s,o,n,i,l,f,w,d=t[1].p&&wt(t);function b(...p){return t[9](t[33],...p)}function C(...p){return t[10](t[33],...p)}return{c(){e=N("div"),d&&d.c(),r=tt(),c=N("canvas"),o=tt(),n=N("canvas"),l=tt(),this.h()},l(p){e=K(p,"DIV",{id:!0,class:!0});var m=F(e);d&&d.l(m),r=et(m),c=K(m,"CANVAS",{id:!0,class:!0,style:!0}),F(c).forEach(x),o=et(m),n=K(m,"CANVAS",{id:!0,class:!0,style:!0}),F(n).forEach(x),l=et(m),m.forEach(x),this.h()},h(){E(c,"id","map"+t[33]),E(c,"class","map svelte-11i875g"),E(c,"style",s=t[2][t[33]]+(t[1].p?"height: 90%;":"")),E(n,"id","view"+t[33]),E(n,"class","view svelte-11i875g"),E(n,"style",i=t[1].p?"height: 90%;":""),E(e,"id","viewport"+t[33]),E(e,"class","viewport svelte-11i875g")},m(p,m){ot(p,e,m),d&&d.m(e,null),B(e,r),B(e,c),B(e,o),B(e,n),B(e,l),f||(w=[U(n,"mousedown",b),U(n,"mousemove",$t(40,C))],f=!0)},p(p,m){t=p,t[1].p?d?d.p(t,m):(d=wt(t),d.c(),d.m(e,r)):d&&(d.d(1),d=null),m[0]&6&&s!==(s=t[2][t[33]]+(t[1].p?"height: 90%;":""))&&E(c,"style",s),m[0]&2&&i!==(i=t[1].p?"height: 90%;":"")&&E(n,"style",i)},d(p){p&&x(e),d&&d.d(),f=!1,bt(w)}}}function Nt(t){let e,r,c,s=[...Array(H).keys()],o=[];for(let n=0;n<s.length;n+=1)o[n]=_t(vt(t,s,n));return{c(){e=N("div");for(let n=0;n<o.length;n+=1)o[n].c();this.h()},l(n){e=K(n,"DIV",{class:!0,style:!0});var i=F(e);for(let l=0;l<o.length;l+=1)o[l].l(i);i.forEach(x),this.h()},h(){E(e,"class","views svelte-11i875g"),E(e,"style",t[3])},m(n,i){ot(n,e,i);for(let l=0;l<o.length;l+=1)o[l].m(e,null);r||(c=[U(window,"keydown",pt(t[4])),U(window,"keyup",pt(t[5]))],r=!0)},p(n,i){if(i[0]&199){s=[...Array(H).keys()];let l;for(l=0;l<s.length;l+=1){const f=vt(n,s,l);o[l]?o[l].p(f,i):(o[l]=_t(f),o[l].c(),o[l].m(e,null))}for(;l<o.length;l+=1)o[l].d(1);o.length=s.length}i[0]&8&&E(e,"style",n[3])},i:mt,o:mt,d(n){n&&x(e),At(o,n),r=!1,bt(c)}}}const Kt=.2,yt=400,H=4;let St=100,Ct=1.1;const Et=20;function Ft(t,e,r){let c;const s=[],o=[],n=[];let i,l,f,w,d,b;const C={},p={},m=h=>{o.forEach(u=>{var lt,ht,ut,ft,dt,gt;let{x:a,y:g,zoom:_}=u;const y=(lt=C.e)!=null?lt:0,S=(ht=C.q)!=null?ht:0,v=y-S,q=Math.pow(1+v*Kt,h);_*=q;const R=(ut=C.a)!=null?ut:0,$=(ft=C.d)!=null?ft:0,z=(dt=C.s)!=null?dt:0,k=(gt=C.w)!=null?gt:0,T=$-R,W=k-z,V=Math.sqrt(T*T+W*W),ct=V>0?1/V:0;a+=ct*T*yt*h,g-=ct*W*yt*h,u.x=a,u.y=g,u.zoom=_,r(8,X+=h)})},L=()=>{const h=i.width/f.width;o.forEach(({x:u,y:a,zoom:g,canvas:_,context:y,map:S})=>{const v=S.canvas.width=_.width=_.offsetWidth,q=S.canvas.height=_.height=_.offsetHeight,R=g>.8,$=R?i:f,z=R?h:1,k=v/g,T=q/g,W=u-k*.5,V=a-T*.5;y.drawImage(d,W,V,k,T,0,0,v,q),S.context.drawImage($,W*z,V*z,k*z,T*z,0,0,v,q)})};let A;const M=h=>{const u=h-A;u>0&&(m(u/1e3),L()),A=h,requestAnimationFrame(M)},O=h=>{C[h.key.toLowerCase()]=1,r(1,p[h.key.toLowerCase()]=!p[h.key.toLowerCase()],p)},J=h=>{C[h.key.toLowerCase()]=0},P=Math.ceil(Math.sqrt(H)),it=`${100/P}% `;let X=180;const Y=[];for(let h=0;h<H;h++)Y.push(`filter: hue-rotate(${X}deg) invert(${St}%) saturate(${Ct});`);Rt(()=>{i=document.createElement("canvas"),l=i.getContext("2d"),f=document.createElement("canvas"),w=f.getContext("2d"),d=document.createElement("canvas"),b=d.getContext("2d");for(let a=0;a<H;a++)s.push({}),s[a].canvas=document.getElementById(`map${a}`),s[a].context=s[a].canvas.getContext("2d"),n.push({points:It[a],path:[],pathString:"",editing:-1,color:qt[a]}),Z(a,!0),r(0,n[a].x=n[a].path[0]?n[a].path[0][0]:0,n),r(0,n[a].y=n[a].path[0]?n[a].path[0][1]:0,n),o.push({x:n[a].x,y:n[a].y,zoom:1,map:s[a],ship:n[a]}),o[a].canvas=document.getElementById(`view${a}`),o[a].context=o[a].canvas.getContext("2d"),o.forEach(({canvas:g,map:_})=>{_.canvas.width=g.width=g.offsetWidth,_.canvas.height=g.height=g.offsetHeight});const h=new Image;h.src="/harbor/chart-5000.png",h.onload=()=>{f.width=h.naturalWidth,f.height=h.naturalHeight,d.width=h.naturalWidth,d.height=h.naturalHeight,w.drawImage(h,0,0),s.forEach(({canvas:a,context:g})=>{const _=a.width,y=a.height;g.drawImage(f,0,0,_,y,0,0,_,y)}),Q()};const u=new Image;u.src="/harbor/chart-10000.png",u.onload=()=>{i.width=u.naturalWidth,i.height=u.naturalHeight,l.drawImage(u,0,0)},requestAnimationFrame(M)});const qt=["#ff00d7","#c9ff00","#ff9900","#0982ff"],Q=()=>{const h=d,u=b;u.clearRect(0,0,h.width,h.height),n.forEach(({points:a,path:g,color:_})=>{if(g.length>0){u.beginPath(),u.lineWidth=3,u.strokeStyle=_,u.setLineDash([12,3]);let y=g[0][0],S=g[0][1];u.moveTo(y,S);for(let v=1;v<g.length;v++)y=g[v][0],S=g[v][1],u.lineTo(y,S);u.stroke();for(let v=0;v<a.length;v++)y=a[v][0],S=a[v][1],u.beginPath(),u.arc(y,S,Et,0,2*Math.PI),u.stroke()}})},Z=(h,u)=>{const a=n[h];if(a.points.length>2){const g=Vt(a.points);a.path=Ot(g,.8,1)}u&&(a.pathString=JSON.stringify(a.points))},at=(h,u)=>{const a=n[u],{x:g,y:_,zoom:y,canvas:S}=o[u],v=g+(h.offsetX-S.width*.5)/y,q=_+(h.offsetY-S.height*.5)/y;if(h.button==0){if(a.editing>=0)a.points[a.editing]=[v,q],a.editing=-1;else{for(let k=0;k<a.points.length;k++){var R=v-a.points[k][0],$=q-a.points[k][1],z=Math.sqrt(R*R+$*$);z<Et&&(a.editing=k)}a.editing<0&&a.points.push([v,q])}Z(u,!0),Q()}},rt=(h,u)=>{const a=n[u],{x:g,y:_,zoom:y,canvas:S}=o[u],v=g+(h.offsetX-S.width*.5)/y,q=_+(h.offsetY-S.height*.5)/y;a.editing>=0&&(a.points[a.editing]=[v,q],Z(u),Q())},kt=(h,u)=>at(u,h),Mt=(h,u)=>rt(u,h);return t.$$.update=()=>{if(t.$$.dirty[0]&256)for(let h=0;h<H;h++)r(2,Y[h]=`filter: hue-rotate(${X}deg) invert(${St}%) saturate(${Ct});`,Y)},r(3,c=`
	grid-template-columns: ${it.repeat(P)};
	grid-template-rows: ${it.repeat(P)};`),[n,p,Y,c,O,J,at,rt,X,kt,Mt]}class Xt extends Pt{constructor(e){super(),zt(this,e,Ft,Nt,xt,{},null,[-1,-1])}}export{Xt as default};
