import{S as Wt,i as Ht,s as jt,k as Q,l as Z,m as $,h as W,n as b,b as pt,I as it,B as Mt,J as Bt,K as Et,o as Ot,A as Vt,L as Kt,a as ht,c as ut,G as U,q as Ft,r as Ut,u as Jt}from"../../chunks/index-a6ab4251.js";function kt(t,e,a){var u=a||{},n=u.noTrailing,o=n===void 0?!1:n,r=u.noLeading,l=r===void 0?!1:r,f=u.debounceMode,y=f===void 0?void 0:f,v,M=!1,c=0;function k(){v&&clearTimeout(v)}function N(x){var R=x||{},D=R.upcomingOnly,L=D===void 0?!1:D;k(),M=!L}function _(){for(var x=arguments.length,R=new Array(x),D=0;D<x;D++)R[D]=arguments[D];var L=this,T=Date.now()-c;if(M)return;function q(){c=Date.now(),e.apply(L,R)}function A(){v=void 0}!l&&y&&!v&&q(),k(),y===void 0&&T>t?l?(c=Date.now(),o||(v=setTimeout(y?A:q,t))):q():o!==!0&&(v=setTimeout(y?A:q,y===void 0?t-T:t))}return _.cancel=N,_}function Xt(t,e){return Math.sqrt(at(t,e))}function at(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function Yt(t,e,a){const u=at(e,a);if(u===0)return at(t,e);let n=((t[0]-e[0])*(a[0]-e[0])+(t[1]-e[1])*(a[1]-e[1]))/u;return n=Math.max(0,Math.min(1,n)),at(t,O(e,a,n))}function O(t,e,a){return[t[0]+(e[0]-t[0])*a,t[1]+(e[1]-t[1])*a]}function Gt(t,e){const a=t[e+0],u=t[e+1],n=t[e+2],o=t[e+3];let r=3*u[0]-2*a[0]-o[0];r*=r;let l=3*u[1]-2*a[1]-o[1];l*=l;let f=3*n[0]-2*o[0]-a[0];f*=f;let y=3*n[1]-2*o[1]-a[1];return y*=y,r<f&&(r=f),l<y&&(l=y),r+l}function dt(t,e,a,u){const n=u||[];if(Gt(t,e)<a){const o=t[e+0];n.length?Xt(n[n.length-1],o)>1&&n.push(o):n.push(o),n.push(t[e+3])}else{const r=t[e+0],l=t[e+1],f=t[e+2],y=t[e+3],v=O(r,l,.5),M=O(l,f,.5),c=O(f,y,.5),k=O(v,M,.5),N=O(M,c,.5),_=O(k,N,.5);dt([r,v,k,_],0,a,n),dt([_,N,c,y],0,a,n)}return n}function gt(t,e,a,u,n){const o=n||[],r=t[e],l=t[a-1];let f=0,y=1;for(let v=e+1;v<a-1;++v){const M=Yt(t[v],r,l);M>f&&(f=M,y=v)}return Math.sqrt(f)>u?(gt(t,e,y+1,u,o),gt(t,y,a,u,o)):(o.length||o.push(r),o.push(l)),o}function Qt(t,e=.15,a){const u=[],n=(t.length-1)/3;for(let o=0;o<n;o++){const r=o*3;dt(t,r,e,u)}return a&&a>0?gt(u,0,u.length,a):u}function G(t){return[...t]}function Zt(t,e=0){const a=t.length;if(a<3)throw new Error("A curve must have at least three points.");const u=[];if(a===3)u.push(G(t[0]),G(t[1]),G(t[2]),G(t[2]));else{const n=[];n.push(t[0],t[0]);for(let l=1;l<t.length;l++)n.push(t[l]),l===t.length-1&&n.push(t[l]);const o=[],r=1-e;u.push(G(n[0]));for(let l=1;l+2<n.length;l++){const f=n[l];o[0]=[f[0],f[1]],o[1]=[f[0]+(r*n[l+1][0]-r*n[l-1][0])/6,f[1]+(r*n[l+1][1]-r*n[l-1][1])/6],o[2]=[n[l+1][0]+(r*n[l][0]-r*n[l+2][0])/6,n[l+1][1]+(r*n[l][1]-r*n[l+2][1])/6],o[3]=[n[l+1][0],n[l+1][1]],u.push(o[1],o[2],o[3])}}return u}const xt=[[[500,500],[2500,3280]],[[4500,500],[2500,3280]],[[500,6060],[2500,3280]],[[4500,6060],[2500,3280]]],ot=(t,e,a,u)=>{var n=e-t,o=u-a;return Math.sqrt(n*n+o*o)};const{window:Ct}=Kt;function St(t,e,a){const u=t.slice();return u[38]=e[a],u[40]=a,u}function Pt(t){let e,a=t[2][t[40]].pathString+"",u;return{c(){e=Q("pre"),u=Ft(a),this.h()},l(n){e=Z(n,"PRE",{class:!0});var o=$(e);u=Ut(o,a),o.forEach(W),this.h()},h(){b(e,"class","svelte-cedt8j")},m(n,o){pt(n,e,o),U(e,u)},p(n,o){o[0]&4&&a!==(a=n[2][n[40]].pathString+"")&&Jt(u,a)},d(n){n&&W(e)}}}function bt(t){let e,a,u,n,o,r,l,f,y,v,M,c=t[3]&&Pt(t);function k(..._){return t[15](t[40],..._)}function N(..._){return t[16](t[40],..._)}return{c(){e=Q("div"),c&&c.c(),a=ht(),u=Q("canvas"),o=ht(),r=Q("canvas"),f=ht(),this.h()},l(_){e=Z(_,"DIV",{id:!0,class:!0,style:!0});var x=$(e);c&&c.l(x),a=ut(x),u=Z(x,"CANVAS",{id:!0,class:!0,style:!0}),$(u).forEach(W),o=ut(x),r=Z(x,"CANVAS",{id:!0,class:!0,style:!0}),$(r).forEach(W),f=ut(x),x.forEach(W),this.h()},h(){b(u,"id","map"+t[40]),b(u,"class","map svelte-cedt8j"),b(u,"style",n=t[1][t[40]]+(t[3]?"height: 95%;":"")),b(r,"id","view"+t[40]),b(r,"class","view svelte-cedt8j"),b(r,"style",l=t[3]?"height: 95%;":""),b(e,"id","viewport"+t[40]),b(e,"class","viewport svelte-cedt8j"),b(e,"style",y=t[0]<0||t[0]==t[40]?"":"display: none")},m(_,x){pt(_,e,x),c&&c.m(e,null),U(e,a),U(e,u),U(e,o),U(e,r),U(e,f),v||(M=[it(r,"mousedown",k),it(r,"mousemove",kt(40,N))],v=!0)},p(_,x){t=_,t[3]?c?c.p(t,x):(c=Pt(t),c.c(),c.m(e,a)):c&&(c.d(1),c=null),x[0]&10&&n!==(n=t[1][t[40]]+(t[3]?"height: 95%;":""))&&b(u,"style",n),x[0]&8&&l!==(l=t[3]?"height: 95%;":"")&&b(r,"style",l),x[0]&1&&y!==(y=t[0]<0||t[0]==t[40]?"":"display: none")&&b(e,"style",y)},d(_){_&&W(e),c&&c.d(),v=!1,Et(M)}}}function $t(t){let e,a,u,n=t[4],o=[];for(let r=0;r<n.length;r+=1)o[r]=bt(St(t,n,r));return{c(){e=Q("div");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){e=Z(r,"DIV",{class:!0,style:!0});var l=$(e);for(let f=0;f<o.length;f+=1)o[f].l(l);l.forEach(W),this.h()},h(){b(e,"class","views svelte-cedt8j"),b(e,"style",t[5])},m(r,l){pt(r,e,l);for(let f=0;f<o.length;f+=1)o[f].m(e,null);a||(u=[it(Ct,"keydown",t[6]),it(Ct,"keyup",t[7])],a=!0)},p(r,l){if(l[0]&799){n=r[4];let f;for(f=0;f<n.length;f+=1){const y=St(r,n,f);o[f]?o[f].p(y,l):(o[f]=bt(y),o[f].c(),o[f].m(e,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=n.length}l[0]&32&&b(e,"style",r[5])},i:Mt,o:Mt,d(r){r&&W(e),Bt(o,r),a=!1,Et(u)}}}const te=.2,qt=400,ee=10;let ne=180,se=100,oe=1;const ft=20;function ae(t,e,a){let u,n,o,r,l,f,y;const v=[],M=[],c=[];let k,N,_,x,R,D,L,T;const q={},A={};let rt=.03,z=-1;const It=d=>{var i,h,s,C,w,m;for(let g=0;g<M.length;g++){if(z>=0&&g!=z)continue;const S=M[g],p=c[g];let{x:E,y:P,zoom:H}=S;const V=(i=q.e)!=null?i:0,J=(h=q.q)!=null?h:0,X=V-J,Dt=Math.pow(1+X*te,d);if(H*=Dt,q.r&&(p.pathIndex=0,p.x=p.path[0][0],p.y=p.path[0][1]),A.v&&p.pathIndex<p.path.length-1){let Y=p.pathLength/ee*d;for(;Y>0&&p.pathIndex<p.path.length-1;){let et=p.pathIndex,nt=p.path[et+1][0],K=p.path[et+1][1];const B=ot(p.x,nt,p.y,K);if(B>0&&(p.course=Math.atan2(K-p.y,nt-p.x)),B==0){p.pathIndex++;continue}const F=Math.min(Y,B),st=Math.cos(p.course),Nt=Math.sin(p.course);p.x+=st*F,p.y+=Nt*F,Y-=F}}if(A.f){const j=rt;E=p.x*j+E*(1-j),P=p.y*j+P*(1-j)}else{const j=(s=q.a)!=null?s:0,Y=(C=q.d)!=null?C:0,et=(w=q.s)!=null?w:0,nt=(m=q.w)!=null?m:0,K=Y-j,B=nt-et,F=Math.sqrt(K*K+B*B),st=F>0?1/F:0;E+=st*K*qt*d,P-=st*B*qt*d}S.x=E,S.y=P,S.zoom=H}q.r=!1},Lt=()=>{const d=k.width/_.width;T.clearRect(0,0,L.width,L.height),c.forEach(i=>{T.beginPath(),T.fillStyle=i.color;const h=i.x+Math.cos(i.course)*20,s=i.y+Math.sin(i.course)*20,C=i.x+Math.cos(i.course+Math.PI/1.5)*20,w=i.y+Math.sin(i.course+Math.PI/1.5)*20,m=i.x+Math.cos(i.course-Math.PI/1.5)*20,g=i.y+Math.sin(i.course-Math.PI/1.5)*20;T.moveTo(h,s),T.lineTo(C,w),T.lineTo(i.x,i.y),T.lineTo(m,g),T.fill()}),M.forEach(({x:i,y:h,zoom:s,canvas:C,context:w,map:m})=>{const g=m.canvas.width=C.width=C.offsetWidth,S=m.canvas.height=C.height=C.offsetHeight;s*=z>=0?Math.ceil(Math.sqrt(I)):1;const p=s>.8,E=p?k:_,P=p?d:1,H=g/s,V=S/s,J=i-H*.5,X=h-V*.5;y&&w.drawImage(R,J,X,H,V,0,0,g,S),w.drawImage(L,J,X,H,V,0,0,g,S),m.context.drawImage(E,J*P,X*P,H*P,V*P,0,0,g,S)})};let mt;const yt=kt(0,d=>{const i=d-mt;i>0&&(It(i/1e3),Lt()),mt=d,requestAnimationFrame(yt)}),Tt=d=>{q[d.key.toLowerCase()]=1,a(10,A[d.key.toLowerCase()]=!A[d.key.toLowerCase()],A);let i=parseInt(d.key)-1;i==z||i>=I?a(0,z=-1):a(0,z=isNaN(i)?z:i),tt()},At=d=>{q[d.key.toLowerCase()]=0};let I=4,lt;Ot(async()=>{const d={views:parseInt(new URLSearchParams(window.location.search).get("views")),follow:parseFloat(new URLSearchParams(window.location.search).get("follow"))};a(11,I=isNaN(d.views)?I:d.views),a(4,u=[...Array(I).keys()]),rt=isNaN(d.follow)?rt:d.follow,await Vt(),k=document.createElement("canvas"),N=k.getContext("2d"),_=document.createElement("canvas"),x=_.getContext("2d"),R=document.createElement("canvas"),D=R.getContext("2d"),L=document.createElement("canvas"),T=L.getContext("2d");for(let s=0;s<I;s++){v.push({}),v[s].canvas=document.getElementById(`map${s}`),v[s].context=v[s].canvas.getContext("2d"),c.push({points:xt[s%xt.length],path:[],pathIndex:0,pathLength:0,pathString:"",editing:-1,color:wt[s%wt.length]}),ct(s,!0),a(2,c[s].x=c[s].path[0]?c[s].path[0][0]:-1,c),a(2,c[s].y=c[s].path[0]?c[s].path[0][1]:-1,c);const C=c[s].path[1]?c[s].path[1][0]:c[s].x,w=c[s].path[1]?c[s].path[1][1]:c[s].y;a(2,c[s].course=Math.atan2(w-c[s].y,C-c[s].x),c),M.push({x:c[s].x,y:c[s].y,map:v[s],ship:c[s]}),M[s].canvas=document.getElementById(`view${s}`),M[s].context=M[s].canvas.getContext("2d"),M[s].zoom=L.width/M[s].canvas.width,M.forEach(m=>{const{canvas:g,map:S,zoom:p}=m;S.canvas.width=g.width=g.offsetWidth,S.canvas.height=g.height=g.offsetHeight,m.x=m.x<0?g.width/p*.5:m.x,m.y=m.y<0?g.height/p*.5:m.y})}const i=new Image;i.src="/harbor/chart-5000.png",i.onload=()=>{_.width=i.naturalWidth,_.height=i.naturalHeight,R.width=i.naturalWidth,R.height=i.naturalHeight,L.width=i.naturalWidth,L.height=i.naturalHeight,x.drawImage(i,0,0),v.forEach(({canvas:s,context:C})=>{const w=s.width,m=s.height;C.drawImage(_,0,0,w,m,0,0,w,m)}),tt()};const h=new Image;h.src="/harbor/chart-10000.png",h.onload=()=>{k.width=h.naturalWidth,k.height=h.naturalHeight,N.drawImage(h,0,0)},requestAnimationFrame(yt)});const wt=["#ff00d7","#ff9900","#c9ff00","#0982ff"],tt=()=>{const d=R,i=D;i.clearRect(0,0,d.width,d.height),c.forEach(({points:h,path:s,color:C})=>{if(s.length>0){i.beginPath(),i.lineWidth=3,i.strokeStyle=C,i.setLineDash([12,3]);let w=s[0][0],m=s[0][1];i.moveTo(w,m);for(let g=1;g<s.length;g++)w=s[g][0],m=s[g][1],i.lineTo(w,m);i.stroke();for(let g=0;g<h.length;g++)w=h[g][0],m=h[g][1],i.beginPath(),(!A.o||g==0||g==h.length-1)&&i.arc(w,m,ft,0,2*Math.PI),i.stroke()}})},ct=(d,i)=>{const h=c[d];if(h.points.length>3){const s=Zt(h.points);h.path=Qt(s,.8,1)}else h.path=h.points;h.pathLength=0;for(let s=1;s<h.path.length;s++)h.pathLength+=ot(h.path[s-1][0],h.path[s][0],h.path[s-1][1],h.path[s][1]);i&&(h.pathString=JSON.stringify(h.points))},vt=(d,i)=>{if(!y)return;const h=c[i];let{x:s,y:C,zoom:w,canvas:m}=M[i];w*=z>=0?Math.ceil(Math.sqrt(I)):1;const g=s+(d.offsetX-m.width*.5)/w,S=C+(d.offsetY-m.height*.5)/w;if(d.button==0){if(h.editing>=0){let E=-1;for(let P=0;P<h.points.length;P++)if(Math.abs(P-h.editing)==1){var p=ot(h.points[P][0],g,h.points[P][1],S);p<ft&&(E=P)}E<0?h.points[h.editing]=[g,S]:h.points.splice(h.editing,1),h.editing=-1}else{for(let E=0;E<h.points.length;E++){var p=ot(h.points[E][0],g,h.points[E][1],S);p<ft&&(h.editing=E)}h.editing<0&&h.points.push([g,S])}ct(i,!0),tt()}},_t=(d,i)=>{if(!y)return;const h=c[i];let{x:s,y:C,zoom:w,canvas:m}=M[i];w*=z>=0?Math.ceil(Math.sqrt(I)):1;const g=s+(d.offsetX-m.width*.5)/w,S=C+(d.offsetY-m.height*.5)/w;h.editing>=0&&(h.points[h.editing]=[g,S],ct(i),tt())},Rt=(d,i)=>vt(i,d),zt=(d,i)=>_t(i,d);return t.$$.update=()=>{if(t.$$.dirty[0]&2048&&a(4,u=[...Array(I).keys()]),t.$$.dirty[0]&2049&&a(12,n=z>=0?1:Math.ceil(Math.sqrt(I))),t.$$.dirty[0]&4096&&a(14,o=100/n),t.$$.dirty[0]&16384&&a(13,r=`${o}% `),t.$$.dirty[0]&12288&&a(5,l=`
	grid-template-columns: ${r.repeat(n)};
	grid-template-rows: ${r.repeat(n)};`),t.$$.dirty[0]&2050){a(1,lt=[]);for(let d=0;d<I;d++)lt.push(`filter: hue-rotate(${ne+d*(360/I)*1}deg) invert(${se}%) saturate(${oe});`)}t.$$.dirty[0]&1024&&a(3,f=A.c),t.$$.dirty[0]&1024&&(y=!A.p)},[z,lt,c,f,u,l,Tt,At,vt,_t,A,I,n,r,o,Rt,zt]}class re extends Wt{constructor(e){super(),Ht(this,e,ae,$t,jt,{},null,[-1,-1])}}export{re as default};
