import{S as Wt,i as Ht,s as Bt,k as U,l as Q,m as Z,h as z,n as q,b as dt,I as at,J as vt,B as wt,K as Nt,L as Et,o as Ot,a as ht,c as lt,G as J,q as Vt,r as Kt,u as Ft}from"../../chunks/index-e4a90c97.js";function Jt(t,n,a){var h=a||{},s=h.noTrailing,o=s===void 0?!1:s,r=h.noLeading,l=r===void 0?!1:r,u=h.debounceMode,g=u===void 0?void 0:u,v,f=!1,y=0;function R(){v&&clearTimeout(v)}function k(M){var W=M||{},E=W.upcomingOnly,T=E===void 0?!1:E;R(),f=!T}function x(){for(var M=arguments.length,W=new Array(M),E=0;E<M;E++)W[E]=arguments[E];var T=this,L=Date.now()-y;if(f)return;function A(){y=Date.now(),n.apply(T,W)}function I(){v=void 0}!l&&g&&!v&&A(),R(),g===void 0&&L>t?l?(y=Date.now(),o||(v=setTimeout(g?I:A,t))):A():o!==!0&&(v=setTimeout(g?I:A,g===void 0?t-L:t))}return x.cancel=k,x}function Xt(t,n){return Math.sqrt(ot(t,n))}function ot(t,n){return Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)}function Yt(t,n,a){const h=ot(n,a);if(h===0)return ot(t,n);let s=((t[0]-n[0])*(a[0]-n[0])+(t[1]-n[1])*(a[1]-n[1]))/h;return s=Math.max(0,Math.min(1,s)),ot(t,O(n,a,s))}function O(t,n,a){return[t[0]+(n[0]-t[0])*a,t[1]+(n[1]-t[1])*a]}function jt(t,n){const a=t[n+0],h=t[n+1],s=t[n+2],o=t[n+3];let r=3*h[0]-2*a[0]-o[0];r*=r;let l=3*h[1]-2*a[1]-o[1];l*=l;let u=3*s[0]-2*o[0]-a[0];u*=u;let g=3*s[1]-2*o[1]-a[1];return g*=g,r<u&&(r=u),l<g&&(l=g),r+l}function ut(t,n,a,h){const s=h||[];if(jt(t,n)<a){const o=t[n+0];s.length?Xt(s[s.length-1],o)>1&&s.push(o):s.push(o),s.push(t[n+3])}else{const r=t[n+0],l=t[n+1],u=t[n+2],g=t[n+3],v=O(r,l,.5),f=O(l,u,.5),y=O(u,g,.5),R=O(v,f,.5),k=O(f,y,.5),x=O(R,k,.5);ut([r,v,R,x],0,a,s),ut([x,k,y,g],0,a,s)}return s}function ft(t,n,a,h,s){const o=s||[],r=t[n],l=t[a-1];let u=0,g=1;for(let v=n+1;v<a-1;++v){const f=Yt(t[v],r,l);f>u&&(u=f,g=v)}return Math.sqrt(u)>h?(ft(t,n,g+1,h,o),ft(t,g,a,h,o)):(o.length||o.push(r),o.push(l)),o}function Gt(t,n=.15,a){const h=[],s=(t.length-1)/3;for(let o=0;o<s;o++){const r=o*3;ut(t,r,n,h)}return a&&a>0?ft(h,0,h.length,a):h}function G(t){return[...t]}function Ut(t,n=0){const a=t.length;if(a<3)throw new Error("A curve must have at least three points.");const h=[];if(a===3)h.push(G(t[0]),G(t[1]),G(t[2]),G(t[2]));else{const s=[];s.push(t[0],t[0]);for(let l=1;l<t.length;l++)s.push(t[l]),l===t.length-1&&s.push(t[l]);const o=[],r=1-n;h.push(G(s[0]));for(let l=1;l+2<s.length;l++){const u=s[l];o[0]=[u[0],u[1]],o[1]=[u[0]+(r*s[l+1][0]-r*s[l-1][0])/6,u[1]+(r*s[l+1][1]-r*s[l-1][1])/6],o[2]=[s[l+1][0]+(r*s[l][0]-r*s[l+2][0])/6,s[l+1][1]+(r*s[l][1]-r*s[l+2][1])/6],o[3]=[s[l+1][0],s[l+1][1]],h.push(o[1],o[2],o[3])}}return h}const Qt=[[[3152.059889126087,1582.2779244897192],[2958.577498253122,2456.481932374286],[3123.205653211,3306.4157758369984],[4135.970029298883,3554.4187314194864],[2373.7907435462075,4016.999941682505]],[[0,0]],[[0,0]],[[0,0]]],st=(t,n,a,h)=>{var s=n-t,o=h-a;return Math.sqrt(s*s+o*o)};function _t(t,n,a){const h=t.slice();return h[35]=n[a],h[37]=a,h}function Mt(t){let n,a=t[1][t[37]].pathString+"",h;return{c(){n=U("pre"),h=Vt(a),this.h()},l(s){n=Q(s,"PRE",{class:!0});var o=Z(n);h=Kt(o,a),o.forEach(z),this.h()},h(){q(n,"class","svelte-16xin6")},m(s,o){dt(s,n,o),J(n,h)},p(s,o){o[0]&2&&a!==(a=s[1][s[37]].pathString+"")&&Ft(h,a)},d(s){s&&z(n)}}}function xt(t){let n,a,h,s,o,r,l,u,g,v,f,y=t[3]&&Mt(t);function R(...x){return t[13](t[37],...x)}function k(...x){return t[14](t[37],...x)}return{c(){n=U("div"),y&&y.c(),a=ht(),h=U("canvas"),o=ht(),r=U("canvas"),u=ht(),this.h()},l(x){n=Q(x,"DIV",{id:!0,class:!0,style:!0});var M=Z(n);y&&y.l(M),a=lt(M),h=Q(M,"CANVAS",{id:!0,class:!0,style:!0}),Z(h).forEach(z),o=lt(M),r=Q(M,"CANVAS",{id:!0,class:!0,style:!0}),Z(r).forEach(z),u=lt(M),M.forEach(z),this.h()},h(){q(h,"id","map"+t[37]),q(h,"class","map svelte-16xin6"),q(h,"style",s=t[2][t[37]]+(t[3]?"height: 95%;":"")),q(r,"id","view"+t[37]),q(r,"class","view svelte-16xin6"),q(r,"style",l=t[3]?"height: 95%;":""),q(n,"id","viewport"+t[37]),q(n,"class","viewport svelte-16xin6"),q(n,"style",g=t[0]<0||t[0]==t[37]?"":"display: none")},m(x,M){dt(x,n,M),y&&y.m(n,null),J(n,a),J(n,h),J(n,o),J(n,r),J(n,u),v||(f=[at(r,"mousedown",R),at(r,"mousemove",Jt(40,k))],v=!0)},p(x,M){t=x,t[3]?y?y.p(t,M):(y=Mt(t),y.c(),y.m(n,a)):y&&(y.d(1),y=null),M[0]&12&&s!==(s=t[2][t[37]]+(t[3]?"height: 95%;":""))&&q(h,"style",s),M[0]&8&&l!==(l=t[3]?"height: 95%;":"")&&q(r,"style",l),M[0]&1&&g!==(g=t[0]<0||t[0]==t[37]?"":"display: none")&&q(n,"style",g)},d(x){x&&z(n),y&&y.d(),v=!1,Et(f)}}}function Zt(t){let n,a,h,s=[...Array(D).keys()],o=[];for(let r=0;r<s.length;r+=1)o[r]=xt(_t(t,s,r));return{c(){n=U("div");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){n=Q(r,"DIV",{class:!0,style:!0});var l=Z(n);for(let u=0;u<o.length;u+=1)o[u].l(l);l.forEach(z),this.h()},h(){q(n,"class","views svelte-16xin6"),q(n,"style",t[4])},m(r,l){dt(r,n,l);for(let u=0;u<o.length;u+=1)o[u].m(n,null);a||(h=[at(window,"keydown",vt(t[5])),at(window,"keyup",vt(t[6]))],a=!0)},p(r,l){if(l[0]&399){s=[...Array(D).keys()];let u;for(u=0;u<s.length;u+=1){const g=_t(r,s,u);o[u]?o[u].p(g,l):(o[u]=xt(g),o[u].c(),o[u].m(n,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}l[0]&16&&q(n,"style",r[4])},i:wt,o:wt,d(r){r&&z(n),Nt(o,r),a=!1,Et(h)}}}const $t=.2,Ct=400,te=10,ee=.7,D=4;let St=180,Pt=100,qt=1;const ct=20;function ne(t,n,a){let h,s,o,r,l,u;const g=[],v=[],f=[];let y,R,k,x,M,W,E,T;const L={},A={};let I=-1;const bt=c=>{var i,e,d,C,w,_;for(let p=0;p<v.length;p++){if(I>=0&&p!=I)continue;const S=v[p],m=f[p];let{x:b,y:P,zoom:H}=S;const V=(i=L.e)!=null?i:0,X=(e=L.q)!=null?e:0,Y=V-X,Rt=Math.pow(1+Y*$t,c);if(H*=Rt,L.r&&(m.pathIndex=0,m.x=m.path[0][0],m.y=m.path[0][1]),A.v&&m.pathIndex<m.path.length-1){let j=m.pathLength/te*c;for(;j>0&&m.pathIndex<m.path.length-1;){let tt=m.pathIndex,et=m.path[tt+1][0],K=m.path[tt+1][1];const N=st(m.x,et,m.y,K);if(N>0&&(m.course=Math.atan2(K-m.y,et-m.x)),N==0){m.pathIndex++;continue}const F=Math.min(j,N),nt=Math.cos(m.course),zt=Math.sin(m.course);m.x+=nt*F,m.y+=zt*F,j-=F}}if(A.f){const B=ee*c;b=m.x*B+b*(1-B),P=m.y*B+P*(1-B)}else{const B=(d=L.a)!=null?d:0,j=(C=L.d)!=null?C:0,tt=(w=L.s)!=null?w:0,et=(_=L.w)!=null?_:0,K=j-B,N=et-tt,F=Math.sqrt(K*K+N*N),nt=F>0?1/F:0;b+=nt*K*Ct*c,P-=nt*N*Ct*c}S.x=b,S.y=P,S.zoom=H}L.r=!1},kt=()=>{const c=y.width/k.width;T.clearRect(0,0,E.width,E.height),f.forEach(i=>{T.beginPath(),T.fillStyle=i.color;const e=i.x+Math.cos(i.course)*20,d=i.y+Math.sin(i.course)*20,C=i.x+Math.cos(i.course+Math.PI/1.5)*20,w=i.y+Math.sin(i.course+Math.PI/1.5)*20,_=i.x+Math.cos(i.course-Math.PI/1.5)*20,p=i.y+Math.sin(i.course-Math.PI/1.5)*20;T.moveTo(e,d),T.lineTo(C,w),T.lineTo(i.x,i.y),T.lineTo(_,p),T.fill()}),v.forEach(({x:i,y:e,zoom:d,canvas:C,context:w,map:_})=>{const p=_.canvas.width=C.width=C.offsetWidth,S=_.canvas.height=C.height=C.offsetHeight;d*=I>=0?Math.ceil(Math.sqrt(D)):1;const m=d>.8,b=m?y:k,P=m?c:1,H=p/d,V=S/d,X=i-H*.5,Y=e-V*.5;u&&w.drawImage(M,X,Y,H,V,0,0,p,S),w.drawImage(E,X,Y,H,V,0,0,p,S),_.context.drawImage(b,X*P,Y*P,H*P,V*P,0,0,p,S)})};let gt;const pt=c=>{const i=c-gt;i>0&&(bt(i/1e3),kt()),gt=c,requestAnimationFrame(pt)},It=c=>{L[c.key.toLowerCase()]=1,a(9,A[c.key.toLowerCase()]=!A[c.key.toLowerCase()],A);let i=parseInt(c.key)-1;i==I||i>=D?a(0,I=-1):a(0,I=isNaN(i)?I:i)},Tt=c=>{L[c.key.toLowerCase()]=0},$=[];for(let c=0;c<D;c++)$.push(`filter: hue-rotate(${St+c*(360/D)}deg) invert(${Pt}%) saturate(${qt});`);Ot(()=>{y=document.createElement("canvas"),R=y.getContext("2d"),k=document.createElement("canvas"),x=k.getContext("2d"),M=document.createElement("canvas"),W=M.getContext("2d"),E=document.createElement("canvas"),T=E.getContext("2d");for(let e=0;e<D;e++){g.push({}),g[e].canvas=document.getElementById(`map${e}`),g[e].context=g[e].canvas.getContext("2d"),f.push({points:Qt[e],path:[],pathIndex:0,pathLength:0,pathString:"",editing:-1,color:Lt[e]}),rt(e,!0),a(1,f[e].x=f[e].path[0]?f[e].path[0][0]:0,f),a(1,f[e].y=f[e].path[0]?f[e].path[0][1]:0,f);const d=f[e].path[1]?f[e].path[1][0]:f[e].x,C=f[e].path[1]?f[e].path[1][1]:f[e].y;a(1,f[e].course=Math.atan2(C-f[e].y,d-f[e].x),f),v.push({x:f[e].x,y:f[e].y,zoom:1,map:g[e],ship:f[e]}),v[e].canvas=document.getElementById(`view${e}`),v[e].context=v[e].canvas.getContext("2d"),v.forEach(w=>{const{canvas:_,map:p}=w;p.canvas.width=_.width=_.offsetWidth,p.canvas.height=_.height=_.offsetHeight,w.x=_.width*.5,w.y=_.height*.5})}const c=new Image;c.src="/harbor/chart-5000.png",c.onload=()=>{k.width=c.naturalWidth,k.height=c.naturalHeight,M.width=c.naturalWidth,M.height=c.naturalHeight,E.width=c.naturalWidth,E.height=c.naturalHeight,x.drawImage(c,0,0),g.forEach(({canvas:e,context:d})=>{const C=e.width,w=e.height;d.drawImage(k,0,0,C,w,0,0,C,w)}),it()};const i=new Image;i.src="/harbor/chart-10000.png",i.onload=()=>{y.width=i.naturalWidth,y.height=i.naturalHeight,R.drawImage(i,0,0)},requestAnimationFrame(pt)});const Lt=["#ff00d7","#ff9900","#c9ff00","#0982ff"],it=()=>{const c=M,i=W;i.clearRect(0,0,c.width,c.height),f.forEach(({points:e,path:d,color:C})=>{if(d.length>0){i.beginPath(),i.lineWidth=3,i.strokeStyle=C,i.setLineDash([12,3]);let w=d[0][0],_=d[0][1];i.moveTo(w,_);for(let p=1;p<d.length;p++)w=d[p][0],_=d[p][1],i.lineTo(w,_);i.stroke();for(let p=0;p<e.length;p++)w=e[p][0],_=e[p][1],i.beginPath(),i.arc(w,_,ct,0,2*Math.PI),i.stroke()}})},rt=(c,i)=>{const e=f[c];if(e.points.length>3){const d=Ut(e.points);e.path=Gt(d,.8,1)}else e.path=e.points;e.pathLength=0;for(let d=1;d<e.path.length;d++)e.pathLength+=st(e.path[d-1][0],e.path[d][0],e.path[d-1][1],e.path[d][1]);i&&(e.pathString=JSON.stringify(e.points))},mt=(c,i)=>{if(!u)return;const e=f[i];let{x:d,y:C,zoom:w,canvas:_}=v[i];w*=I>=0?Math.ceil(Math.sqrt(D)):1;const p=d+(c.offsetX-_.width*.5)/w,S=C+(c.offsetY-_.height*.5)/w;if(c.button==0){if(e.editing>=0){let b=-1;for(let P=0;P<e.points.length;P++)if(Math.abs(P-e.editing)==1){var m=st(e.points[P][0],p,e.points[P][1],S);m<ct&&(b=P)}b<0?e.points[e.editing]=[p,S]:e.points.splice(e.editing,1),e.editing=-1}else{for(let b=0;b<e.points.length;b++){var m=st(e.points[b][0],p,e.points[b][1],S);m<ct&&(e.editing=b)}e.editing<0&&e.points.push([p,S])}rt(i,!0),it()}},yt=(c,i)=>{if(!u)return;const e=f[i];let{x:d,y:C,zoom:w,canvas:_}=v[i];w*=I>=0?Math.ceil(Math.sqrt(D)):1;const p=d+(c.offsetX-_.width*.5)/w,S=C+(c.offsetY-_.height*.5)/w;e.editing>=0&&(e.points[e.editing]=[p,S],rt(i),it())},At=(c,i)=>mt(i,c),Dt=(c,i)=>yt(i,c);t.$$.update=()=>{t.$$.dirty[0]&1&&a(10,h=I>=0?1:Math.ceil(Math.sqrt(D))),t.$$.dirty[0]&1024&&a(12,s=100/h),t.$$.dirty[0]&4096&&a(11,o=`${s}% `),t.$$.dirty[0]&3072&&a(4,r=`
	grid-template-columns: ${o.repeat(h)};
	grid-template-rows: ${o.repeat(h)};`),t.$$.dirty[0]&512&&a(3,l=A.c),t.$$.dirty[0]&512&&(u=!A.p)};for(let c=0;c<D;c++)a(2,$[c]=`filter: hue-rotate(${St+c*(360/D)}deg) invert(${Pt}%) saturate(${qt});`,$);return[I,f,$,l,r,It,Tt,mt,yt,A,h,o,s,At,Dt]}class oe extends Wt{constructor(n){super(),Ht(this,n,ne,Zt,Bt,{},null,[-1,-1])}}export{oe as default};
